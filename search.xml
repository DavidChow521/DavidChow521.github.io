<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>TCMS数据中心数据表</title>
      <link href="/article/ck8fv8lg60015h4pwt5yt1noy.html"/>
      <url>/article/ck8fv8lg60015h4pwt5yt1noy.html</url>
      
        <content type="html"><![CDATA[<h4 id="订单主表">订单主表</h4><h5 id="注意事项">注意事项</h5><blockquote><p>{<strong>@xxxx</strong>} <em>可替换参数</em></p><ul><li>bil_income_{<strong>@customer_id}</strong>_{<strong>@arrival_date</strong>:%Y%m}分表规则<br><code>例：bil_income_3_201910</code></li><li>currency_code币种代码TCMS与FIP不一致<br><code>例：when CNY then RMB</code></li><li>arrival_date计费UTC时间<br><code>例：ADDTIME(arrival_date,'08:00:00')</code></li><li>TCMS订单没有截止时间，导致订单号会重复计费，也就是说会存在<strong>订单号重复</strong>的情况</li></ul></blockquote><h5 id="数据表">数据表</h5><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th style="text-align:center">来源系统</th><th style="text-align:center">来源表</th><th>字段</th><th>字段说明</th></tr></thead><tbody><tr><td>OrderNumber</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户Id}_{年月}</td><td>refer_hawbcode</td><td>订单号</td></tr><tr><td>CustomerCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bsn_business</td><td>customer_code</td><td>客户代码</td></tr><tr><td>WaybillNumber</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户ID}_{年月}</td><td>shipper_hawbcode</td><td>运单号</td></tr><tr><td>ServiceNumber</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户Id}_{年月}</td><td>serve_hawbcode</td><td>服务商单号</td></tr><tr><td>CurrencyCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户Id}_{年月}</td><td><code>currency_code</code></td><td>币种</td></tr><tr><td>DestinationCountry</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bsn_business</td><td>destination_countrycode</td><td>目的国家</td></tr><tr><td>Weight</td><td style="text-align:center">decimal</td><td style="text-align:center">TCMS</td><td style="text-align:center">bsn_business</td><td>checkin_grossweight</td><td>实重(kg)</td></tr><tr><td>BillingWeight</td><td style="text-align:center">decimal</td><td style="text-align:center">TCMS</td><td style="text-align:center">bsn_business</td><td>shipper_chargeweight</td><td>计费重(kg)</td></tr><tr><td>ProductName</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">csi_productkind</td><td>product_cnname</td><td>物流产品名称</td></tr><tr><td>ProductCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">csi_productkind</td><td>product_code</td><td>物流产品代码</td></tr><tr><td>ZipCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bsn_business</td><td>destination_postcode</td><td>邮编</td></tr><tr><td>BillingPartition</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">xtd_zone_division<br>xtd_zone_scheme</td><td>zn_name<br>zs_name</td><td>计费分区</td></tr><tr><td>OrderType</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户ID}_{年月}</td><td>amount_type</td><td>计费类型：0-正向 1-退件</td></tr><tr><td>Amount</td><td style="text-align:center">decimal</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户ID}_{年月}</td><td>ic_amount</td><td>应收金额</td></tr><tr><td>BillingTime</td><td style="text-align:center">datetime</td><td style="text-align:center">TCMS</td><td style="text-align:center">bsn_business</td><td><code>arrival_date</code></td><td>计费时间：UTC</td></tr><tr><td>WarehouseCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">sys_organization</td><td>og_shortcode</td><td>仓库代码</td></tr><tr><td>WarehouseName</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">sys_organization</td><td>og_name</td><td>仓库名称</td></tr><tr><td>PrealertDate</td><td style="text-align:center">datetime</td><td style="text-align:center">TCMS</td><td style="text-align:center">bsn_business</td><td>prealert_date</td><td>预报时间</td></tr></tbody></table><h5 id="sql脚本">SQL脚本</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 第1步.业务基础数据</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">c.customer_code,p.product_cnname,d.zn_name,s.zs_name,o.og_shortcode,o.og_name,b.bs_id,b.arrival_date,</span><br><span class="line">b.customer_id,b.destination_countrycode,b.checkin_grossweight,b.shipper_chargeweight,b.product_code,b.prealert_date</span><br><span class="line">b.destination_postcode,b.zd_id,b.zs_id,b.checkin_og_id</span><br><span class="line">  <span class="keyword">from</span> bsn_business b</span><br><span class="line">  <span class="keyword">left</span> <span class="keyword">join</span> csi_productkind   p <span class="keyword">on</span> b.product_code = p.product_code </span><br><span class="line">  <span class="keyword">left</span> <span class="keyword">join</span> csi_customer      c <span class="keyword">on</span> b.customer_id = c.customer_id</span><br><span class="line">  <span class="keyword">left</span> <span class="keyword">join</span> xtd_zone_scheme   s <span class="keyword">on</span> b.zs_id = s.zs_id  </span><br><span class="line">  <span class="keyword">left</span> <span class="keyword">join</span> sys_organization  o <span class="keyword">on</span> b.checkin_og_id = o.og_id</span><br><span class="line">  <span class="keyword">left</span> <span class="keyword">join</span> xtd_zone_division d <span class="keyword">on</span> d.zs_id = b.zs_id <span class="keyword">and</span> d.zd_id=b.zd_id</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第2步.客户分表数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">CONCAT</span>(</span><br><span class="line">        <span class="string">'insert into tmp_bil_Income_all</span></span><br><span class="line"><span class="string">         select * from bil_income_'</span>,</span><br><span class="line">         customer_id,</span><br><span class="line">         <span class="string">'_'</span>,</span><br><span class="line">         arrival_date,</span><br><span class="line">         <span class="string">' c where c.bs_id in  (select b.bs_id from tmp_bsn_business b )'</span></span><br><span class="line">        ) </span><br><span class="line"> <span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">distinct</span>(customer_id)customer_id,<span class="keyword">DATE_FORMAT</span>(arrival_date,<span class="string">'%Y%m'</span>)arrival_date </span><br><span class="line">      <span class="keyword">from</span> tmp_bsn_business</span><br><span class="line">) t</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第3步.组装订单数据</span></span><br><span class="line"><span class="keyword">select</span>  </span><br><span class="line">o.bs_id TmsId,</span><br><span class="line">o.arrival_date BillingTime,</span><br><span class="line">o.destination_countrycode DestinationCountry,</span><br><span class="line">o.checkin_grossweight Weight,</span><br><span class="line">o.shipper_chargeweight BillingWeight,</span><br><span class="line">o.product_cnname ProductName,</span><br><span class="line">o.product_code ProductCode,</span><br><span class="line">o.destination_postcode ZipCode,</span><br><span class="line">o.customer_code CustomerCode,</span><br><span class="line"><span class="keyword">CONCAT</span>(o.zn_name,<span class="string">','</span>,o.zs_name) BillingPartition,</span><br><span class="line">o.og_name WarehouseName,</span><br><span class="line">o.og_shortcode WarehouseCode,</span><br><span class="line">od.refer_hawbcode OrderNumber,</span><br><span class="line">od.shipper_hawbcode WaybillNumber,</span><br><span class="line">od.serve_hawbcode ServiceNumber,</span><br><span class="line">(<span class="keyword">case</span> od.currency_code <span class="keyword">when</span> <span class="string">'CNY'</span> <span class="keyword">then</span> <span class="string">'RNB'</span> <span class="keyword">else</span> od.currency_code <span class="keyword">end</span>)  CurrencyCode,</span><br><span class="line">od.amount_type OrderType,</span><br><span class="line">od.ic_amount Amount,</span><br><span class="line">o.prealert_date PrealertDate</span><br><span class="line"> <span class="keyword">from</span></span><br><span class="line">    tmp_bsn_business o</span><br><span class="line"> <span class="keyword">left</span> <span class="keyword">join</span>(</span><br><span class="line"><span class="keyword">select</span> refer_hawbcode,shipper_hawbcode,serve_hawbcode,currency_code,</span><br><span class="line"><span class="keyword">max</span>(amount_type) amount_type,</span><br><span class="line"><span class="keyword">sum</span>(ic_amount) ic_amount,bs_id </span><br><span class="line">  <span class="keyword">from</span> tmp_bil_Income_all  a </span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span>  refer_hawbcode,shipper_hawbcode,serve_hawbcode,currency_code,bs_id </span><br><span class="line"> ) od </span><br><span class="line">   <span class="keyword">on</span> o.bs_id=od.bs_id</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">ifnull</span>(od.refer_hawbcode,<span class="string">''</span>)&lt;&gt;<span class="string">''</span>;</span><br></pre></td></tr></table></figure><h4 id="订单明细表">订单明细表</h4><h5 id="数据表">数据表</h5><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th style="text-align:center">来源系统</th><th style="text-align:center">来源表</th><th>字段</th><th>字段说明</th></tr></thead><tbody><tr><td>OrderNumber</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户Id}_{年月}</td><td>refer_hawbcode</td><td>订单号</td></tr><tr><td>TypesOfFee</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户Id}_{年月}</td><td>fk_code</td><td>费用代码</td></tr><tr><td>Amount</td><td style="text-align:center">decimal</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户Id}_{年月}</td><td>ic_amount</td><td>金额</td></tr><tr><td>AddTime</td><td style="text-align:center">datetime</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户Id}_{年月}</td><td>ic_createdate</td><td>创建时间</td></tr><tr><td>SourceId</td><td style="text-align:center">int</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户Id}_{年月}</td><td>ic_id</td><td>外部主键Id</td></tr></tbody></table><h5 id="sql脚本">SQL脚本</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 第1步.组装订单明细</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">od.refer_hawbcode OrderNumber,</span><br><span class="line">od.fk_code TypesOfFee,</span><br><span class="line"> od.ic_amount Amount,</span><br><span class="line">od.ic_createdate <span class="keyword">AddTime</span>,</span><br><span class="line">od.ic_id SourceId</span><br><span class="line"> <span class="keyword">from</span> tmp_bil_Income_all od</span><br></pre></td></tr></table></figure><h4 id="账单主表">账单主表</h4><h5 id="注意事项">注意事项</h5><blockquote><ul><li>billcompany_id服务主体TCMS与FIP不一致<br><code>例：when 2 then 0</code></li><li>sb_billdate账单UTC日期、sb_createdate创建UTC时间<br><code>例：ADDTIME(sb_billdate,'08:00:00')</code><br><code>例：ADDTIME(sb_createdate,'08:00:00')</code></li><li>BillToTime取当前客户最后一个账单的账单日期+1天<br><code>例：DATE_ADD(sb_billdate,INTERVAL 1 DAY)</code></li></ul></blockquote><h5 id="数据表">数据表</h5><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th style="text-align:center">来源系统</th><th style="text-align:center">来源表</th><th>字段</th><th>字段说明</th></tr></thead><tbody><tr><td>BillNumber</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>sb_labelcode</td><td>账单号</td></tr><tr><td>CustomerCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">csi_customer</td><td>customer_code</td><td>客户代码</td></tr><tr><td>ServiceSubject</td><td style="text-align:center">int</td><td style="text-align:center">TCMS</td><td style="text-align:center">csi_customer</td><td><code>billcompany_id</code></td><td>服务主体</td></tr><tr><td>GenerationMethod</td><td style="text-align:center">int</td><td style="text-align:center">TCMS</td><td style="text-align:center"></td><td></td><td>生成方式：默认2-手动生成</td></tr><tr><td>BillFromTime</td><td style="text-align:center">datetime</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td><code>sb_billdate</code></td><td>账单开始时间：UTC</td></tr><tr><td><code>BillToTime</code></td><td style="text-align:center">datetime</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td><code>sb_billdate</code></td><td>账单结束时间：UTC</td></tr><tr><td>BillFile</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>sb_publishfile</td><td>账单文件路径</td></tr><tr><td>BillCreateTime</td><td style="text-align:center">datetime</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td><code>sb_createdate</code></td><td>账单生成时间</td></tr><tr><td>BillStart</td><td style="text-align:center">int</td><td style="text-align:center">TCMS</td><td style="text-align:center"></td><td></td><td>审核状态：默认1-审核成功</td></tr></tbody></table><h5 id="sql脚本">SQL脚本</h5> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 第1步.组装账单主表数据</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">        b.sb_labelcode BillNumber,</span><br><span class="line">    c.customer_code CustomerCode,</span><br><span class="line">    (<span class="keyword">case</span> c.billcompany_id <span class="keyword">when</span> <span class="string">'2'</span> <span class="keyword">then</span> <span class="string">'0'</span> <span class="keyword">else</span> c.billcompany_id <span class="keyword">end</span>) ServiceSubject,</span><br><span class="line">    <span class="number">2</span> GenerationMethod,</span><br><span class="line">    <span class="keyword">ADDTIME</span>(b.sb_billdate,<span class="string">'08:00:00'</span>) BillToTime,</span><br><span class="line">    <span class="keyword">DATE_ADD</span>(</span><br><span class="line">            (</span><br><span class="line">            <span class="keyword">select</span></span><br><span class="line">                <span class="keyword">ADDTIME</span>(tmp_b.sb_billdate,<span class="string">'08:00:00'</span>) </span><br><span class="line">              <span class="keyword">from</span></span><br><span class="line">                bil_shipperbill tmp_b </span><br><span class="line">             <span class="keyword">where</span></span><br><span class="line">                tmp_b.customer_id = b.customer_id </span><br><span class="line">               <span class="keyword">and</span> tmp_b.sb_billdate &lt; b.sb_billdate </span><br><span class="line">             <span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">                sb_billdate <span class="keyword">desc</span> </span><br><span class="line">             <span class="keyword">limit</span> <span class="number">1</span> </span><br><span class="line">            ),</span><br><span class="line">            <span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span> </span><br><span class="line">    ) BillFromTime,</span><br><span class="line">    b.sb_publishfile BillFile,</span><br><span class="line">    <span class="keyword">ADDTIME</span>(b.sb_createdate,<span class="string">'08:00:00'</span>) BillCreateTime,</span><br><span class="line">    <span class="number">1</span> BillStart,</span><br><span class="line">  <span class="keyword">from</span></span><br><span class="line">    bil_shipperbill b</span><br><span class="line">  <span class="keyword">left</span> <span class="keyword">join</span> csi_customer c <span class="keyword">ON</span> b.customer_id = c.customer_id</span><br></pre></td></tr></table></figure><h4 id="账单明细表">账单明细表</h4><h5 id="注意事项">注意事项</h5><blockquote><ul><li>currency_code币种代码TCMS与FIP不一致<br><code>例：when CNY then RMB</code></li></ul></blockquote><h5 id="数据表">数据表</h5><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th style="text-align:center">来源系统</th><th style="text-align:center">来源表</th><th>字段</th><th>字段名称</th></tr></thead><tbody><tr><td>BillNumber</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>sb_labelcode</td><td>账单号</td></tr><tr><td>CurrencyCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td><code>currency_code</code></td><td>币种</td></tr><tr><td>AllTotal</td><td style="text-align:center">decimal</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>sb_amount</td><td>账单总金额</td></tr><tr><td>StartBalance</td><td style="text-align:center">decimal</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>last_balance</td><td>期初余额</td></tr><tr><td>EndBalance</td><td style="text-align:center">decimal</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>balance</td><td>期末余额</td></tr><tr><td>CurrentPeriodDeposit</td><td style="text-align:center">decimal</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>CurrentPeriodDeposit</td><td>本期充值</td></tr></tbody></table><h5 id="sql脚本">SQL脚本</h5> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 第1步.组装账单明细数据</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">        b.sb_labelcode BillNumber,</span><br><span class="line">        b.currency_code CurrencyCode,</span><br><span class="line">        (<span class="keyword">case</span> <span class="keyword">ifnull</span>(b.last_balance,<span class="number">0</span>) <span class="keyword">when</span> <span class="string">''</span> <span class="keyword">then</span> <span class="number">0</span> <span class="keyword">else</span> b.last_balance <span class="keyword">end</span>) StartBalance,</span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="keyword">sum</span>(<span class="keyword">IFNULL</span>( actual_money_sum, sc_currentamount)) actual_money_sum <span class="keyword">FROM</span> stm_shippercurrent ss </span><br><span class="line">            <span class="keyword">WHERE</span> ss.sm_code=<span class="string">'EE'</span> <span class="keyword">AND</span> ss.fm_code=<span class="string">'CA'</span> <span class="keyword">AND</span> ss.scs_code=<span class="string">'C'</span></span><br><span class="line">            <span class="keyword">AND</span> ss.customer_id=b.customer_id <span class="keyword">AND</span> ss.ck_code=b.currency_code</span><br><span class="line">            <span class="keyword">AND</span> ss.sc_createdate &gt;= 账单主表.BillFromTime <span class="keyword">AND</span> ss.sc_createdate &lt; 账单主表.BillToTime</span><br><span class="line">        )CurrentPeriodDeposit,</span><br><span class="line">        (<span class="keyword">case</span> <span class="keyword">ifnull</span>(b.balance,<span class="number">0</span>) <span class="keyword">when</span> <span class="string">''</span> <span class="keyword">then</span> <span class="number">0</span> <span class="keyword">else</span> b.balance <span class="keyword">end</span> ) EndBalance,</span><br><span class="line">        (<span class="keyword">case</span> <span class="keyword">ifnull</span>(b.sb_amount,<span class="number">0</span>) <span class="keyword">when</span> <span class="string">''</span> <span class="keyword">then</span> <span class="number">0</span> <span class="keyword">else</span> b.sb_amount <span class="keyword">end</span> ) AllTotal,</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    bil_shipperbill b</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> csi_customer c <span class="keyword">on</span>  b.customer_id = c.customer_id</span><br></pre></td></tr></table></figure><h4 id="账单统计表">账单统计表</h4><h5 id="注意事项">注意事项</h5><blockquote><ul><li>currency_code币种代码TCMS与FIP不一致<br><code>例：when CNY then RMB</code></li><li>计费类型OrderType根据服务商单号、运单号、订单号判断<br><code>例：case when (bsi.serve_hawbcode=bsi.refer_hawbcode and bsi.serve_hawbcode=bsi.shipper_hawbcode) then 1 else 0 end</code></li></ul></blockquote><h5 id="数据表">数据表</h5><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th style="text-align:center">来源系统</th><th style="text-align:center">来源表</th><th>字段</th><th>字段名称</th></tr></thead><tbody><tr><td>BillNumber</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>sb_labelcode</td><td>账单号</td></tr><tr><td>OrderType</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_income_{客户ID}_{年月}</td><td><code>amount_type</code></td><td>计费类型：0-正向 1-退件</td></tr><tr><td>TypesOfFee</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>fk_code</td><td>费用代码</td></tr><tr><td>CurrencyCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td><code>currency_code</code></td><td>币种</td></tr><tr><td>AllTotal</td><td style="text-align:center">decimal</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>Total</td><td>总金额</td></tr><tr><td>WarehouseCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>og_shortcode</td><td>仓库代码</td></tr><tr><td>Unit</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">bil_shipperbill</td><td>unit_code</td><td>计算单位</td></tr></tbody></table><h5 id="sql脚本">SQL脚本</h5> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 第1步.账单关联订单数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">CONCAT</span>(</span><br><span class="line">   <span class="string">' insert into tmp_fin_billbusinesspackage'</span>,</span><br><span class="line">   <span class="string">' select b.sb_labelcode BillNumber,b.sb_createdate BillCreateTime,cc.customer_code CustomerCode, bsi.refer_hawbcode OrderNumber,'</span>,</span><br><span class="line">   <span class="string">' bsi.amount_type OrderType, '</span>,a.SharedingId,<span class="string">' SharedingId ,bsi.currency_code CurrencyCode,'</span></span><br><span class="line">   <span class="string">' bsi.ic_amount Total,so.og_shortcode WarehouseCode,so.og_name WarehouseName,'</span>,</span><br><span class="line">   <span class="string">' IFNULL(bb.checkin_grossweight,0) Weight,3 BillType,'</span>,</span><br><span class="line">   <span class="string">' bsi.fk_code,bsi.unit_code,bsi.serve_hawbcode,bsi.refer_hawbcode,bsi.shipper_hawbcode,'</span>,</span><br><span class="line">   <span class="string">' ifnull((case  when (bsi.serve_hawbcode=bsi.refer_hawbcode and bsi.serve_hawbcode=bsi.shipper_hawbcode)  then 1  else  0 end),0) OrderTypeStatic,'</span></span><br><span class="line">   <span class="string">' bb.arrival_date ChargeDate,'</span></span><br><span class="line">   <span class="string">' bb.product_code ServiceType,'</span></span><br><span class="line">   <span class="string">' bsi.serve_hawbcode TrackingNo'</span></span><br><span class="line">   <span class="string">' from '</span>,</span><br><span class="line">   a.bil_income_table_name,</span><br><span class="line">   <span class="string">' bsi'</span>,</span><br><span class="line">   <span class="string">' left join sys_organization so on bsi.og_id=so.og_id'</span>,</span><br><span class="line">   <span class="string">' left join bsn_business  bb on bsi.bs_id=bb.bs_id'</span>,</span><br><span class="line">   <span class="string">' left join bil_shipperbill b on bsi.sb_id=b.sb_id'</span>,</span><br><span class="line">   <span class="string">' left join csi_customer cc ON b.customer_id = cc.customer_id'</span></span><br><span class="line">  )  <span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">  <span class="keyword">distinct</span> m.bil_income_table_name,<span class="keyword">DATE_FORMAT</span>(b.sb_billdate,<span class="string">'%Y%m'</span>)SharedingId</span><br><span class="line">      <span class="keyword">from</span> bil_shipperbill b</span><br><span class="line">      <span class="keyword">left</span> <span class="keyword">join</span> csi_customer c <span class="keyword">on</span>  b.customer_id = c.customer_id</span><br><span class="line">      <span class="keyword">left</span> <span class="keyword">join</span> bil_shipperbill_mapping m <span class="keyword">on</span> b.sb_id=m.sb_id</span><br><span class="line">) a</span><br><span class="line"><span class="comment">-- 第2步.组装账单统计数据</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">        a.BillNumber,a.OrderTypeStatic,a.fk_code,a.CurrencyCode,a.AllTotal,a.WarehouseCode,a.unit_code </span><br><span class="line">  <span class="keyword">from</span> (</span><br><span class="line">        <span class="keyword">select</span> b.fk_code,b.CurrencyCode,b.unit_code,b.WarehouseCode,b.OrderTypeStatic,<span class="keyword">sum</span>(b.Total)AllTotal,b.BillNumber </span><br><span class="line">          <span class="keyword">from</span> tmp_fin_billbusinesspackage  b</span><br><span class="line">         <span class="keyword">group</span> <span class="keyword">by</span> b.fk_code,b.CurrencyCode,b.unit_code,b.WarehouseCode,b.OrderTypeStatic,b.BillNumber</span><br><span class="line">  ) a</span><br></pre></td></tr></table></figure><h4 id="客户">客户</h4><h5 id="注意事项">注意事项</h5><blockquote><ul><li>billcompany_id服务主体TCMS与FIP不一致<br><code>例：when 2 then 0</code></li></ul></blockquote><h5 id="数据表">数据表</h5><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th style="text-align:center">来源系统</th><th style="text-align:center">来源表</th><th>字段</th><th>字段名称</th></tr></thead><tbody><tr><td>CustomerCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">csi_customer</td><td>customer_code</td><td>客户代码</td></tr><tr><td>CompanyName</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">csi_customer</td><td>customer_allname</td><td>公司名称</td></tr><tr><td>ServiceSubject</td><td style="text-align:center">int</td><td style="text-align:center">TCMS</td><td style="text-align:center">csi_customer</td><td><code>billcompany_id</code></td><td>服务主体</td></tr></tbody></table><h5 id="sql脚本">SQL脚本</h5> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_code,customer_allname,billcompany_id </span><br><span class="line">   <span class="keyword">from</span> csi_customer</span><br></pre></td></tr></table></figure><h4 id="仓库">仓库</h4><h5 id="注意事项">注意事项</h5><blockquote><ul><li>currency_code币种代码TCMS与FIP不一致<br><code>例：when CNY then RMB</code></li></ul></blockquote><h5 id="数据表">数据表</h5><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th style="text-align:center">来源系统</th><th style="text-align:center">来源表</th><th>字段</th><th>字段名称</th></tr></thead><tbody><tr><td>WarehouseCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">sys_organization</td><td>og_shortcode</td><td>仓库代码</td></tr><tr><td>WarehouseName</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">sys_organization</td><td>og_name</td><td>仓库名称</td></tr><tr><td>CountryCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">sys_organization</td><td><code>country_code</code></td><td>国家代码</td></tr><tr><td>CurrencyCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">sys_organization</td><td>ck_code</td><td>币种</td></tr></tbody></table><h5 id="sql脚本">SQL脚本</h5> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> og_shortcode,og_name,country_code,ck_code </span><br><span class="line">   <span class="keyword">from</span> sys_organization</span><br></pre></td></tr></table></figure><h4 id="费用项">费用项</h4><h5 id="数据表">数据表</h5><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th style="text-align:center">来源系统</th><th style="text-align:center">来源表</th><th>字段</th><th>字段名称</th></tr></thead><tbody><tr><td>TypesOfFeeCode</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">xtd_customer_feekind</td><td>fk_code</td><td>费用类型代码</td></tr><tr><td>TypesOfFeeNameCn</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">xtd_customer_feekind</td><td>fk_name</td><td>费用类型中文</td></tr><tr><td>TypesOfFeeNameEn</td><td style="text-align:center">string</td><td style="text-align:center">TCMS</td><td style="text-align:center">xtd_customer_feekind</td><td>fk_ename</td><td>费用类型英文</td></tr></tbody></table><h5 id="sql脚本">SQL脚本</h5> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> fk_code,fk_name,fk_ename </span><br><span class="line">   <span class="keyword">from</span> xtd_customer_feekind</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cmd生成webservice客户端类wsdl</title>
      <link href="/article/cjx1inx0b087fp0rj7u1uyhof.html"/>
      <url>/article/cjx1inx0b087fp0rj7u1uyhof.html</url>
      
        <content type="html"><![CDATA[<p>在c盘搜索“wsdl.exe”，如何复制路径如下图</p><p>wsdl /language:c# /n:项目名 /out:文件地址 服务地址<br>wsdl /language:c# /n:com.service.demo /out:d:/DosomethingService.cs <a href="http://localhost/webDemo/DosomethingService.asmx" target="_blank" rel="noopener">http://localhost/webDemo/DosomethingService.asmx</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSharp获取真实文件类型</title>
      <link href="/article/ck0sz4fuq000xtguz7ipbuo7y.html"/>
      <url>/article/ck0sz4fuq000xtguz7ipbuo7y.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">string</span> <span class="title">IsAllowedExtenstion</span>(<span class="params"><span class="keyword">string</span> filePath</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fileClass=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">using</span>(FileStream fs=<span class="keyword">new</span> FileStream(filePath,FileMode.Open,FileAccess.Read))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span>(BinaryReader reader = <span class="keyword">new</span> BinaryReader(fs))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,i&lt;<span class="number">2</span>,i++)</span><br><span class="line">            &#123;</span><br><span class="line">                fileClass+=reader.ReadByte();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义文件类型枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> FileExtension</span><br><span class="line">&#123;</span><br><span class="line">    JPG = <span class="number">255216</span>,</span><br><span class="line">    GIF = <span class="number">7173</span>,</span><br><span class="line">    BMP = <span class="number">6677</span>,</span><br><span class="line">    PNG = <span class="number">13780</span>,</span><br><span class="line">    COM = <span class="number">7790</span>,</span><br><span class="line">    EXE = <span class="number">7790</span>,</span><br><span class="line">    DLL = <span class="number">7790</span>,</span><br><span class="line">    RAR = <span class="number">8297</span>,</span><br><span class="line">    ZIP = <span class="number">8075</span>,</span><br><span class="line">    XML = <span class="number">6063</span>,</span><br><span class="line">    HTML = <span class="number">6033</span>,</span><br><span class="line">    ASPX = <span class="number">239187</span>,</span><br><span class="line">    CS = <span class="number">117115</span>,</span><br><span class="line">    JS = <span class="number">119105</span>,</span><br><span class="line">    TXT = <span class="number">210187</span>,</span><br><span class="line">    SQL = <span class="number">255254</span>,</span><br><span class="line">    BAT = <span class="number">64101</span>,</span><br><span class="line">    BTSEED = <span class="number">10056</span>,</span><br><span class="line">    RDP = <span class="number">255254</span>,</span><br><span class="line">    PSD = <span class="number">5666</span>,</span><br><span class="line">    PDF = <span class="number">3780</span>,</span><br><span class="line">    CHM = <span class="number">7384</span>,</span><br><span class="line">    LOG = <span class="number">70105</span>,</span><br><span class="line">    REG = <span class="number">8269</span>,</span><br><span class="line">    HLP = <span class="number">6395</span>,</span><br><span class="line">    DOC = <span class="number">208207</span>,</span><br><span class="line">    XLS = <span class="number">208207</span>,</span><br><span class="line">    DOCX = <span class="number">208207</span>,</span><br><span class="line">    XLSX = <span class="number">208207</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Csharp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSharp NPOI Excel</title>
      <link href="/article/ck0de40vr0087413srjfdp9mzo5.html"/>
      <url>/article/ck0de40vr0087413srjfdp9mzo5.html</url>
      
        <content type="html"><![CDATA[<h3 id="使用">使用</h3><blockquote><p>Nuget下载 Install-package NPOI -Version 2.4.1</p></blockquote><h4 id="创建工作簿">创建工作簿</h4><p><code>HSSFWorkbook</code>:2003以前(包括03)版本，扩展名.xls;<br><code>XSSFWorkbook</code>:2007后版本，扩展名.xlsx;</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//建立空白工作簿</span></span><br><span class="line">IWorkbook workbook = <span class="keyword">new</span> XSSFWorkbook();</span><br><span class="line"><span class="comment">//建立空白工作表</span></span><br><span class="line">ISheet sheet = workbook.CreateSheet();</span><br></pre></td></tr></table></figure><h4 id="创建单元格">创建单元格</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//建立行，参数为行号，从0计</span></span><br><span class="line">IRow row = sheet.CreateRow(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//建立单元格，参数为列号，从0计</span></span><br><span class="line">ICell cell = row.CreateCell(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//设置单元格内容</span></span><br><span class="line">cell.SetCellValue(<span class="string">"Hello World!"</span>);</span><br></pre></td></tr></table></figure><h5 id="设置样式">设置样式</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ICellStyle style = workbook.CreateCellStyle();</span><br><span class="line"><span class="comment">//设置单元格的样式：水平对齐居中</span></span><br><span class="line">style.Alignment = HorizontalAlignment.CENTER;</span><br><span class="line"><span class="comment">//新建一个字体样式对象</span></span><br><span class="line">IFont font = workbook.CreateFont();</span><br><span class="line"><span class="comment">//设置字体大小</span></span><br><span class="line">font.FontHeightInPoints = <span class="number">11</span>;</span><br><span class="line"><span class="comment">//设置字体高度 20等于1px 等同于FontHeightInPoints = 11</span></span><br><span class="line"><span class="comment">//font.FontHeight = 220;</span></span><br><span class="line"><span class="comment">//设置字体</span></span><br><span class="line">font.FontName = <span class="string">"微软雅黑"</span>;</span><br><span class="line"><span class="comment">//设置字体加粗样式</span></span><br><span class="line">font.Boldweight = <span class="keyword">short</span>.MaxValue;</span><br><span class="line"><span class="comment">//使用SetFont方法将字体样式添加到单元格样式中 </span></span><br><span class="line">style.SetFont(font);</span><br><span class="line"><span class="comment">//将新的样式赋给单元格</span></span><br><span class="line">cell.CellStyle = style;</span><br></pre></td></tr></table></figure><h5 id="设置宽高">设置宽高</h5><blockquote><p><code>单元格的高度</code> 实际是设置其所在行高，所以要在单元格所在行上设置行高，行高设置数值好像是像素点的1/20，所以*20以便达到设置效果；<br><code>单元格的宽度</code> 实际上是设置其所在列宽，所以要在单元格所在列上设置（列的设置在工作表上），宽度数值好像是字符的1/256</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置单元格的高度</span></span><br><span class="line">row.Height = <span class="number">30</span> * <span class="number">20</span>;</span><br><span class="line"><span class="comment">//设置单元格的宽度</span></span><br><span class="line">sheet.SetColumnWidth(<span class="number">0</span>, <span class="number">30</span> * <span class="number">256</span>);</span><br></pre></td></tr></table></figure><h5 id="设置格式">设置格式</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//千分位</span></span><br><span class="line">workbook.CreateDataFormat().GetFormat(<span class="string">"#,##0.000"</span>);</span><br><span class="line"><span class="comment">//保留2位小数位</span></span><br><span class="line">workbook.CreateDataFormat().GetFormat(<span class="string">"0.00"</span>);</span><br></pre></td></tr></table></figure><h5 id="合并单元格">合并单元格</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置一个合并单元格区域，使用上下左右定义CellRangeAddress区域</span></span><br><span class="line"><span class="comment">//CellRangeAddress四个参数为：起始行，结束行，起始列，结束列</span></span><br><span class="line">sheet.AddMergedRegion(<span class="keyword">new</span> CellRangeAddress(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>));</span><br></pre></td></tr></table></figure><h5 id="添加公式">添加公式</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过Cell的CellFormula向单元格中写入公式</span></span><br><span class="line"><span class="comment">//注：直接写公式内容即可，不需要在最前加'='</span></span><br><span class="line">ICell cell2 = sheet.CreateRow(<span class="number">1</span>).CreateCell(<span class="number">0</span>);</span><br><span class="line">cell2.CellFormula = <span class="string">"F3+F4"</span>;</span><br></pre></td></tr></table></figure><h4 id="创建excel">创建Excel</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件路径</span></span><br><span class="line"><span class="keyword">var</span> path = Directory.GetCurrentDirectory() + <span class="string">"/wwwroot"</span>;</span><br><span class="line"><span class="keyword">var</span> filePath = <span class="string">"/bill/"</span> + DateTime.Now.ToString(<span class="string">"yyyyMMdd"</span>);</span><br><span class="line"><span class="comment">//如果不存在就创建file文件夹</span></span><br><span class="line"><span class="keyword">if</span> (!System.IO.Directory.Exists(path + filePath))</span><br><span class="line">&#123;</span><br><span class="line">    System.IO.Directory.CreateDirectory(path + filePath);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//文件名</span></span><br><span class="line"><span class="keyword">string</span> fileName = DateTime.Now.ToString(<span class="string">"yyyyMMddHHmmss"</span>) + <span class="string">".xls"</span>;</span><br><span class="line"><span class="comment">// 写入到客户端    </span></span><br><span class="line"><span class="keyword">using</span> (System.IO.MemoryStream ms = <span class="keyword">new</span> System.IO.MemoryStream())</span><br><span class="line">&#123;</span><br><span class="line">    workbook.Write(ms);</span><br><span class="line">    ms.Flush();</span><br><span class="line">    ms.Close();</span><br><span class="line">    <span class="keyword">using</span> (FileStream fs = <span class="keyword">new</span> FileStream(path + filePath + <span class="string">"/"</span> + fileName, FileMode.Create, FileAccess.Write))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] data = ms.ToArray();</span><br><span class="line">        fs.Write(data, <span class="number">0</span>, data.Length);</span><br><span class="line">        fs.Flush();</span><br><span class="line">        fs.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="常见问题及解决方案">常见问题及解决方案</h3><h4 id="hssfworkbook合并单元格设置边框无效">HSSFWorkbook合并单元格设置边框无效</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">HSSFWorkbook workbook = <span class="keyword">new</span> HSSFWorkbook();</span><br><span class="line">HSSFSheet sheet1 = workbook.CreateSheet(<span class="string">"Sheet1"</span>) <span class="keyword">as</span> HSSFSheet;</span><br><span class="line"></span><br><span class="line"><span class="comment">//CellRangeAddress四个参数为：起始行，结束行，起始列，结束列</span></span><br><span class="line">CellRangeAddress region=<span class="keyword">new</span> CellRangeAddress(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>)；</span><br><span class="line">sheet.AddMergedRegion(region);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = region.FirstRow; i &lt;= region.LastRow; i++)</span><br><span class="line">&#123;</span><br><span class="line">    IRow row = HSSFCellUtil.GetRow(i, sheet);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = region.FirstColumn; j &lt;= region.LastColumn; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        ICell singleCell = HSSFCellUtil.GetCell(row, (<span class="keyword">short</span>)j);</span><br><span class="line">        singleCell.CellStyle.BorderBottom = BorderStyle.Thin;</span><br><span class="line">        singleCell.CellStyle.BorderLeft = BorderStyle.Thin;</span><br><span class="line">        singleCell.CellStyle.BorderRight = BorderStyle.Thin;</span><br><span class="line">        singleCell.CellStyle.BorderTop = BorderStyle.Thin;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> NPOI </tag>
            
            <tag> Excel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>金蝶K3对接</title>
      <link href="/article/ck0de40vr00006srjfdp9mzo5.html"/>
      <url>/article/ck0de40vr00006srjfdp9mzo5.html</url>
      
        <content type="html"><![CDATA[<h3 id="资料">资料</h3><blockquote><p>数据架构模型 <a href="https://open.kingdee.com/K3Cloud/CDPPortal/DataModel.aspx" target="_blank" rel="noopener">https://open.kingdee.com/K3Cloud/CDPPortal/DataModel.aspx</a></p></blockquote><p>KingDeeK3Helper.cs</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">region</span> SDK</span></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 帐套Id</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> acctID;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 用户名</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> username;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 密码</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> password;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 根地址</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> origin;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">KingDeeK3Helper</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    acctID = AppConfigurtaionServices.Configuration.GetSection(<span class="string">"KingDeeK3:AccountID"</span>).Value;</span><br><span class="line">    username = AppConfigurtaionServices.Configuration.GetSection(<span class="string">"KingDeeK3:UserName"</span>).Value;</span><br><span class="line">    password = AppConfigurtaionServices.Configuration.GetSection(<span class="string">"KingDeeK3:Password"</span>).Value;</span><br><span class="line">    origin = AppConfigurtaionServices.Configuration.GetSection(<span class="string">"KingDeeK3:Origin"</span>).Value.TrimEnd(<span class="string">'/'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 金蝶登录</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">LoginKingDee</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    KingDeeHttpClient httpClient = <span class="keyword">new</span> KingDeeHttpClient</span><br><span class="line">    &#123;</span><br><span class="line">        Url=<span class="string">$"<span class="subst">&#123;origin&#125;</span>/k3cloud/Kingdee.BOS.WebApi.ServicesStub.AuthService.ValidateUser.common.kdsvc"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    List&lt;<span class="keyword">object</span>&gt; parameters = <span class="keyword">new</span> List&lt;<span class="keyword">object</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        acctID,</span><br><span class="line">        username,</span><br><span class="line">        password,</span><br><span class="line">        <span class="number">2052</span></span><br><span class="line">    &#125;;</span><br><span class="line">    httpClient.Content = JsonConvert.SerializeObject(Parameters);</span><br><span class="line">    <span class="keyword">var</span> iResult = JObject.Parse(httpClient.AsyncRequest())[<span class="string">"LoginResultType"</span>].Value&lt;<span class="keyword">int</span>&gt;();</span><br><span class="line">    <span class="keyword">if</span> (iResult == <span class="number">1</span> || iResult == <span class="number">-5</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 金蝶单据查询接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="formId"&gt;</span>金蝶对应的formid<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="fieldKeys"&gt;</span>需要查询的字段在数据库中的名称<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">KingDeeExecuteBillQuery</span>(<span class="params"><span class="keyword">string</span> formId, <span class="keyword">string</span> fieldKeys</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    KingDeeHttpClient httpClient = <span class="keyword">new</span> KingDeeHttpClient</span><br><span class="line">    &#123;</span><br><span class="line">        Url = <span class="string">$"<span class="subst">&#123;origin&#125;</span>/k3cloud/Kingdee.BOS.WebApi.ServicesStub.DynamicFormService.ExecuteBillQuery.common.kdsvc"</span></span><br><span class="line">    &#125;;</span><br><span class="line">    List&lt;<span class="keyword">object</span>&gt; parameters = <span class="keyword">new</span> List&lt;<span class="keyword">object</span>&gt;();</span><br><span class="line">    <span class="keyword">string</span> data = <span class="string">"&#123;\"FormId\":\""</span> + formId + <span class="string">"\",\"FieldKeys\":\""</span> + fieldKeys + <span class="string">"\",\"FilterString\":\"\",\"OrderString\":\"\",\"TopRowCount\":\"0\",\"StartRow\":\""</span> + startRow + <span class="string">"\",\"Limit\":\""</span> + limit + <span class="string">"\"&#125;"</span>;</span><br><span class="line">    parameters.Add(data);</span><br><span class="line">    httpClient.Content = JsonConvert.SerializeObject(parameters);</span><br><span class="line">    <span class="keyword">var</span> result = httpClient.AsyncRequest();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 金蝶保存接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="formId"&gt;</span>表单Id<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="jsonData"&gt;</span>json参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">KingDeeSave</span>(<span class="params"><span class="keyword">string</span> formId, <span class="keyword">string</span> jsonData</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    KingDeeHttpClient httpClient = <span class="keyword">new</span> KingDeeHttpClient</span><br><span class="line">    &#123;</span><br><span class="line">        Url = <span class="string">$"<span class="subst">&#123;origin&#125;</span>/k3cloud/Kingdee.BOS.WebApi.ServicesStub.DynamicFormService.Save.common.kdsvc"</span></span><br><span class="line">    &#125;;</span><br><span class="line">    List&lt;<span class="keyword">object</span>&gt; parameters = <span class="keyword">new</span> List&lt;<span class="keyword">object</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        formId,</span><br><span class="line">        jsonData</span><br><span class="line">    &#125;;</span><br><span class="line">    httpClient.Content = JsonConvert.SerializeObject(parameters);</span><br><span class="line">    <span class="keyword">var</span> result = httpClient.AsyncRequest();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 金蝶提交接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="formId"&gt;</span>表单Id<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="jsonData"&gt;</span>json参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">KingDeeSubmit</span>(<span class="params"><span class="keyword">string</span> formId, <span class="keyword">string</span> jsonData</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    KingDeeHttpClient httpClient = <span class="keyword">new</span> KingDeeHttpClient</span><br><span class="line">    &#123;</span><br><span class="line">        Url = <span class="string">$"<span class="subst">&#123;origin&#125;</span>/k3cloud/Kingdee.BOS.WebApi.ServicesStub.DynamicFormService.Submit.common.kdsvc"</span></span><br><span class="line">    &#125;;</span><br><span class="line">    List&lt;<span class="keyword">object</span>&gt; parameters = <span class="keyword">new</span> List&lt;<span class="keyword">object</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        formId,</span><br><span class="line">        jsonData</span><br><span class="line">    &#125;;</span><br><span class="line">    httpClient.Content = JsonConvert.SerializeObject(parameters);</span><br><span class="line">    <span class="keyword">var</span> result = httpClient.AsyncRequest();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 金蝶审核接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="formId"&gt;</span>表单Id<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="jsonData"&gt;</span>json参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">KingDeeAudit</span>(<span class="params"><span class="keyword">string</span> formId, <span class="keyword">string</span> jsonData</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    KingDeeHttpClient httpClient = <span class="keyword">new</span> KingDeeHttpClient</span><br><span class="line">    &#123;</span><br><span class="line">        Url = <span class="string">$"<span class="subst">&#123;origin&#125;</span>/k3cloud/Kingdee.BOS.WebApi.ServicesStub.DynamicFormService.Audit.common.kdsvc"</span></span><br><span class="line">    &#125;;</span><br><span class="line">    List&lt;<span class="keyword">object</span>&gt; parameters = <span class="keyword">new</span> List&lt;<span class="keyword">object</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        formId,</span><br><span class="line">        jsonData</span><br><span class="line">    &#125;;</span><br><span class="line">    httpClient.Content = JsonConvert.SerializeObject(parameters);</span><br><span class="line">    <span class="keyword">var</span> result = httpClient.AsyncRequest();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">region</span> Interface</span></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 金蝶单据查询接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="formid"&gt;</span>金蝶对应的formid<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="fieldkeys"&gt;</span>需要查询的字段在数据库中的名称<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> List&lt;Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;&gt; GetBillQuery(<span class="keyword">string</span> formid, <span class="keyword">string</span> fieldkeys, intstartRow = <span class="number">0</span>, <span class="keyword">int</span> limit = <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    List&lt;Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;&gt; list = <span class="keyword">new</span> List&lt;Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;&gt;();</span><br><span class="line">    <span class="comment">//登陆系统</span></span><br><span class="line">    <span class="keyword">var</span> result = KingDeeK3Helper.LoginKingDee();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(result))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//单据查询</span></span><br><span class="line">    result = KingDeeK3Helper.KingDeeExecuteBillQuery(formid, fieldkeys, startRow, limit);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(result))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//拆分字段</span></span><br><span class="line">    <span class="keyword">var</span> fiels = fieldkeys.Split(<span class="string">','</span>);</span><br><span class="line">    <span class="keyword">var</span> responseData = JsonConvert.DeserializeObject&lt;List&lt;<span class="keyword">string</span>[]&gt;&gt;(result);</span><br><span class="line">    Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt; dict = <span class="literal">null</span>;</span><br><span class="line">    responseData.ForEach(f =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        dict = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; f.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            dict.Add(fiels[i], f[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        list.Add(dict);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 金蝶保存接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> List&lt;Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;&gt; Save(<span class="keyword">string</span> formId, <span class="keyword">string</span> jsonData)</span><br><span class="line">&#123;</span><br><span class="line">    List&lt;Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;&gt; list = <span class="keyword">new</span> List&lt;Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;&gt;();</span><br><span class="line">    <span class="comment">//登陆系统</span></span><br><span class="line">    <span class="keyword">var</span> result = KingDeeK3Helper.LoginKingDee();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(result))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    result = KingDeeK3Helper.KingDeeSave(formId, jsonData);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(result))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> responseData = JsonConvert.DeserializeObject&lt;JObject&gt;(result);</span><br><span class="line">    <span class="keyword">var</span> job = responseData[<span class="string">"Result"</span>][<span class="string">"ResponseStatus"</span>];</span><br><span class="line">    <span class="keyword">if</span> (job[<span class="string">"IsSuccess"</span>].ToString() == <span class="string">"true"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        list.Add(<span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt; &#123; &#123; <span class="string">"Id"</span>, job[<span class="string">"Id"</span>].ToString() &#125;, &#123; <span class="string">"Number"</span>, job[<span class="string">"Number"</span>].ToString() &#125; &#125;);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">region</span> POST</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">class</span> <span class="title">KingDeeHttpClient</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span>  URL</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Url &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 内容</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Content &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Cookie，保证登录后，所有访问持有一个Cookie；</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> CookieContainer Cookie = <span class="keyword">new</span> CookieContainer();</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> HTTP访问</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">AsyncRequest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (WebRequest.Create(Url) <span class="keyword">is</span> HttpWebRequest httpRequest)</span><br><span class="line">        &#123;</span><br><span class="line">            httpRequest.Method = <span class="string">"POST"</span>;</span><br><span class="line">            httpRequest.ContentType = <span class="string">"application/json"</span>;</span><br><span class="line">            httpRequest.CookieContainer = Cookie;</span><br><span class="line">            httpRequest.Timeout = <span class="number">1000</span> * <span class="number">60</span> * <span class="number">10</span>; <span class="comment">//10min</span></span><br><span class="line">            <span class="keyword">using</span> (Stream reqStream = httpRequest.GetRequestStream())</span><br><span class="line">            &#123;</span><br><span class="line">                JObject jObj = <span class="keyword">new</span> JObject</span><br><span class="line">                &#123;</span><br><span class="line">                    &#123;<span class="string">"format"</span>, <span class="number">1</span>&#125;,</span><br><span class="line">                    &#123;<span class="string">"useragent"</span>, <span class="string">"ApiClient"</span>&#125;,</span><br><span class="line">                    &#123;<span class="string">"rid"</span>, Guid.NewGuid().ToString().GetHashCode().ToString()&#125;,</span><br><span class="line">                    &#123;<span class="string">"parameters"</span>, Content&#125;,</span><br><span class="line">                    &#123;<span class="string">"timestamp"</span>, DateTime.Now&#125;,</span><br><span class="line">                    &#123;<span class="string">"v"</span>, <span class="string">"1.0"</span>&#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">string</span> sContent = jObj.ToString();</span><br><span class="line">                <span class="keyword">var</span> bytes = Encoding.UTF8.GetBytes(sContent);</span><br><span class="line">                reqStream.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line">                reqStream.Flush();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> repStream = httpRequest.GetResponse().GetResponseStream())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> reader = <span class="keyword">new</span> StreamReader(repStream ?? <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException()))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> ValidateResult(reader.ReadToEnd());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">ValidateResult</span>(<span class="params"><span class="keyword">string</span> responseText</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (responseText.StartsWith(<span class="string">"response_error:"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> responseText.TrimStart(<span class="string">"response_error:"</span>.ToCharArray());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> responseText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endregion</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> KingDeeK3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python自动化测试</title>
      <link href="/article/cjxa1hgx80006ykrji1ruwe5r.html"/>
      <url>/article/cjxa1hgx80006ykrji1ruwe5r.html</url>
      
        <content type="html"><![CDATA[<h3 id="准备">准备</h3><blockquote><p>1.下载Python，<a href="https://www.python.org/ftp/python/3.7.0/python-3.7.0-amd64.exe" target="_blank" rel="noopener">X64环境</a>或<a href="https://www.python.org/ftp/python/3.7.0/python-3.7.0.exe" target="_blank" rel="noopener">X86环境</a><br>2.配置环境变量<br>3.pip install selenium<br>4.下载<a href="http://npm.taobao.org/mirrors/chromedriver" target="_blank" rel="noopener">chrome驱动</a></p></blockquote><h3 id="案例">案例</h3><p><a href="http://autologin.py" target="_blank" rel="noopener">autologin.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># # -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> common</span><br><span class="line"></span><br><span class="line">__DEF__=&#123;</span><br><span class="line">    <span class="string">"url"</span>:<span class="string">"登录地址"</span>,</span><br><span class="line">    <span class="string">"account"</span>:<span class="string">"账户"</span>,</span><br><span class="line">    <span class="string">"password"</span>:<span class="string">"密码"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__FILTER__=&#123;</span><br><span class="line">    <span class="string">"account"</span>:&#123;</span><br><span class="line">        <span class="string">"id"</span>:<span class="string">"元素ID值"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"password"</span>:&#123;</span><br><span class="line">        <span class="string">"id"</span>:<span class="string">"元素ID值"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"captcha"</span>:&#123;</span><br><span class="line">        <span class="string">"enable"</span>:<span class="string">"是否有验证码True/False"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"login"</span>:&#123;</span><br><span class="line">        <span class="string">"class_name"</span>:<span class="string">"元素样式值"</span>,</span><br><span class="line">        <span class="string">"event"</span>:<span class="string">"事件"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">common.AutoLogin(__DEF__,__FILTER__)</span><br></pre></td></tr></table></figure><p><a href="http://interface.py" target="_blank" rel="noopener">interface.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># # -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> common</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局配置</span></span><br><span class="line">common.__global__=&#123;</span><br><span class="line">    <span class="string">"environment"</span>:&#123;</span><br><span class="line">        <span class="string">"dev"</span>:&#123;</span><br><span class="line">            <span class="comment"># 根地址</span></span><br><span class="line">            <span class="string">"apiOrigin"</span>:<span class="string">"接口地址"</span>,<span class="string">"authOrigin"</span>:<span class="string">"授权地址"</span>,</span><br><span class="line">            <span class="comment"># 账号密码</span></span><br><span class="line">            <span class="string">"account"</span>:<span class="string">""</span>, <span class="string">"password"</span>:<span class="string">""</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"test"</span>:&#123;</span><br><span class="line">           </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"sbx"</span>:&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"pro"</span>:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认配置</span></span><br><span class="line">common.__default__ = &#123;</span><br><span class="line">    <span class="string">"env"</span>:<span class="string">"dev"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取参数项</span></span><br><span class="line">__options__=common.__global__[<span class="string">"environment"</span>][common.__default__[<span class="string">"env"</span>]]</span><br><span class="line">__headers__=&#123;</span><br><span class="line">    <span class="string">"Authorization"</span>:<span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序入口</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    </span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p><a href="http://common.py" target="_blank" rel="noopener">common.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># # -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"><span class="keyword">from</span> urllib3 <span class="keyword">import</span> encode_multipart_formdata</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局变量</span></span><br><span class="line">__global__=<span class="keyword">None</span></span><br><span class="line"><span class="comment"># 默认参数</span></span><br><span class="line">__default__=<span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动登陆</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AutoLogin</span><span class="params">(__DEF__,__FILTER__)</span>:</span></span><br><span class="line">    <span class="comment"># 如果不是安装的浏览器，需要设置地址</span></span><br><span class="line">    <span class="comment"># options = webdriver.ChromeOptions()</span></span><br><span class="line">    <span class="comment"># options.binary_location = "E:\Chrome\Application\chrome.exe"</span></span><br><span class="line"><span class="comment"># driver = webdriver.Chrome(chrome_options = options)</span></span><br><span class="line"></span><br><span class="line">    driver = webdriver.Chrome()</span><br><span class="line">    driver.maximize_window()</span><br><span class="line">    driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    driver.get(__DEF__.get(<span class="string">"url"</span>))</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    element=<span class="string">"driver.find_element_by_"</span></span><br><span class="line">    element_event=<span class="string">""</span></span><br><span class="line">    element_login=<span class="string">""</span>    </span><br><span class="line">    isLogin=<span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> __FILTER__:</span><br><span class="line">        <span class="keyword">for</span> textbox <span class="keyword">in</span> __FILTER__.get(item):</span><br><span class="line">            <span class="keyword">if</span> item==<span class="string">"login"</span>:</span><br><span class="line">                <span class="keyword">if</span>(textbox==<span class="string">"id"</span> <span class="keyword">or</span> textbox==<span class="string">"class_name"</span> <span class="keyword">or</span> textbox==<span class="string">"name"</span> <span class="keyword">or</span> textbox==<span class="string">"tag_name"</span> <span class="keyword">or</span> textbox==<span class="string">"css_selector"</span> <span class="keyword">or</span> textbox==<span class="string">"xpath"</span>):</span><br><span class="line">                    element_login=element+textbox+<span class="string">'(__FILTER__.get("'</span>+item+<span class="string">'").get("'</span>+textbox+<span class="string">'"))'</span></span><br><span class="line">                <span class="keyword">elif</span> textbox==<span class="string">"event"</span>:</span><br><span class="line">                    element_event=<span class="string">"."</span>+__FILTER__.get(item).get(textbox)+<span class="string">"()"</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">elif</span> item==<span class="string">"captcha"</span>:</span><br><span class="line">                isLogin=__FILTER__.get(item).get(textbox)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span>(textbox==<span class="string">"id"</span> <span class="keyword">or</span> textbox==<span class="string">"class_name"</span> <span class="keyword">or</span> textbox==<span class="string">"name"</span> <span class="keyword">or</span> textbox==<span class="string">"tag_name"</span> <span class="keyword">or</span> textbox==<span class="string">"css_selector"</span> <span class="keyword">or</span> textbox==<span class="string">"xpath"</span>):</span><br><span class="line">                    time.sleep(<span class="number">2</span>)</span><br><span class="line">                    eval(element+textbox+<span class="string">'(__FILTER__.get("'</span>+item+<span class="string">'").get("'</span>+textbox+<span class="string">'")).send_keys(__DEF__.get("'</span>+item+<span class="string">'"))'</span>)</span><br><span class="line">    <span class="keyword">if</span> isLogin==<span class="number">0</span>:</span><br><span class="line">        eval(element_login+element_event)</span><br><span class="line">    </span><br><span class="line">    input(<span class="string">'Press Ctrl+C to stop.'</span>)</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加属性</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Append</span><span class="params">(old,new)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> name, value <span class="keyword">in</span> new.items():</span><br><span class="line">        old[name]=value</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建线程池</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CreateThread</span><span class="params">(fn,count)</span>:</span></span><br><span class="line">    <span class="comment"># 一行代码，创建线程池</span></span><br><span class="line">    <span class="keyword">with</span> ThreadPoolExecutor() <span class="keyword">as</span> pool:</span><br><span class="line">        pool.map(fn,range(count))</span><br><span class="line">    <span class="comment"># 标准语法</span></span><br><span class="line">    <span class="comment"># def f(i):</span></span><br><span class="line">    <span class="comment">#     print(i)</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入本机配置ini文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">WriteIni</span><span class="params">(section,items)</span>:</span></span><br><span class="line">    <span class="comment"># 用os模块来读取</span></span><br><span class="line">    curpath=os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">    <span class="comment"># 读取到本机的配置文件</span></span><br><span class="line">    cfgpath=os.path.join(curpath,<span class="string">"config.ini"</span>)  </span><br><span class="line">    <span class="comment"># 由于ini文件中可能有同名项，所以做异常处理</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        config=configparser.ConfigParser()</span><br><span class="line">        config.read(cfgpath)</span><br><span class="line">        <span class="keyword">if</span>(config.has_section(section)!=<span class="keyword">True</span>):</span><br><span class="line">            config.add_section(section)</span><br><span class="line">        <span class="keyword">for</span> name, value <span class="keyword">in</span> items.items():</span><br><span class="line">            config.set(section,name,str(value))</span><br><span class="line">    <span class="keyword">except</span> configparser.DuplicateSectionError:</span><br><span class="line">        print(<span class="string">"Section '&#123;0&#125;' already exists"</span>.format(section))</span><br><span class="line">    config.write(open(cfgpath, <span class="string">"w"</span>))</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取本机配置ini文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ReadIni</span><span class="params">(section,key)</span>:</span></span><br><span class="line">    <span class="comment"># 用os模块来读取</span></span><br><span class="line">    curpath=os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">    <span class="comment"># 读取到本机的配置文件</span></span><br><span class="line">    cfgpath=os.path.join(curpath,<span class="string">"config.ini"</span>)</span><br><span class="line">    <span class="comment"># 由于ini文件中可能不存在，所以做异常处理</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        config=configparser.ConfigParser()</span><br><span class="line">        config.read(cfgpath)</span><br><span class="line">        <span class="keyword">return</span> config.get(section,key)</span><br><span class="line">    <span class="keyword">except</span> configparser.NoSectionError:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取授权Token</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IdentityServer4</span><span class="params">()</span>:</span></span><br><span class="line">    access_token=ReadIni(<span class="string">"IdentityServer4"</span>,<span class="string">"access_token"</span>)</span><br><span class="line">    expires_in=ReadIni(<span class="string">"IdentityServer4"</span>,<span class="string">"expires_in"</span>)</span><br><span class="line">    request_time=ReadIni(<span class="string">"IdentityServer4"</span>,<span class="string">"request_time"</span>)</span><br><span class="line">    <span class="keyword">if</span>(request_time!=<span class="keyword">None</span>):</span><br><span class="line">        rdate=datetime.datetime.strptime(request_time,<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">    ndate=datetime.datetime.now()</span><br><span class="line">    <span class="keyword">if</span>(access_token==<span class="keyword">None</span> <span class="keyword">or</span> (ndate-rdate).seconds&gt;=int(expires_in)):</span><br><span class="line">        options=__global__[<span class="string">"environment"</span>][__default__[<span class="string">"env"</span>]]</span><br><span class="line">        method=options[<span class="string">"authOrigin"</span>].format(<span class="string">":5000/connect/token"</span>)</span><br><span class="line">        headers=&#123;</span><br><span class="line">            <span class="string">"Content-Type"</span>:<span class="string">"multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        params = OrderedDict([(<span class="string">"client_id"</span>, (<span class="keyword">None</span>, <span class="string">'client'</span>, <span class="string">'multipart/form-data'</span>)),</span><br><span class="line">                      (<span class="string">"client_secret"</span>, (<span class="keyword">None</span>, <span class="string">'secret'</span>, <span class="string">'multipart/form-data'</span>)),</span><br><span class="line">                      (<span class="string">'grant_type'</span>, (<span class="keyword">None</span>, <span class="string">'password'</span>, <span class="string">'multipart/form-data'</span>)),</span><br><span class="line">                      (<span class="string">'username'</span>, (<span class="keyword">None</span>, options[<span class="string">"account"</span>], <span class="string">'multipart/form-data'</span>)),</span><br><span class="line">                      (<span class="string">'password'</span>, (<span class="keyword">None</span>, options[<span class="string">"password"</span>], <span class="string">'multipart/form-data'</span>))])</span><br><span class="line">        formData = encode_multipart_formdata(params, boundary=<span class="string">'----WebKitFormBoundary7MA4YWxkTrZu0gW'</span>)</span><br><span class="line">        response=requests.post(method,data=formData[<span class="number">0</span>],headers=headers)</span><br><span class="line">        jsonData=json.loads(response.text)</span><br><span class="line">        WriteIni(<span class="string">"IdentityServer4"</span>,&#123;</span><br><span class="line">            <span class="string">"access_token"</span>:jsonData[<span class="string">"access_token"</span>],</span><br><span class="line">            <span class="string">"expires_in"</span>:jsonData[<span class="string">"expires_in"</span>],</span><br><span class="line">            <span class="comment"># 时间戳</span></span><br><span class="line">            <span class="string">"request_time"</span>:datetime.datetime.strftime(ndate,<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> jsonData[<span class="string">"access_token"</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> access_token</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取授权Token</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">HttpBasicAuth</span><span class="params">()</span>:</span></span><br><span class="line">    access_token=ReadIni(<span class="string">"BasicAuth"</span>,<span class="string">"access_token"</span>)    </span><br><span class="line">    ndate=datetime.datetime.now()</span><br><span class="line">    <span class="keyword">if</span>(access_token==<span class="keyword">None</span>):</span><br><span class="line">        options=__global__[<span class="string">"environment"</span>][__default__[<span class="string">"env"</span>]]</span><br><span class="line">        temp_str = options[<span class="string">"account"</span>] + <span class="string">':'</span> + options[<span class="string">"password"</span>]</span><br><span class="line">        <span class="comment"># 转成bytes string</span></span><br><span class="line">        bytesString = temp_str.encode(encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        <span class="comment"># base64 编码</span></span><br><span class="line">        encodestr = base64.b64encode(bytesString)</span><br><span class="line">        <span class="comment"># 解码</span></span><br><span class="line">        decodestr = base64.b64decode(encodestr)</span><br><span class="line">        token=<span class="string">'Basic '</span> + encodestr.decode()</span><br><span class="line">        WriteIni(<span class="string">"BasicAuth"</span>,&#123;</span><br><span class="line">            <span class="string">"access_token"</span>:token,</span><br><span class="line">            <span class="comment"># 时间戳</span></span><br><span class="line">            <span class="string">"request_time"</span>:datetime.datetime.strftime(ndate,<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> token</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> access_token</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建日志文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CreateLog</span><span class="params">(method,headers,request,elapsed,response)</span>:</span></span><br><span class="line">    <span class="comment"># 取方法名</span></span><br><span class="line">    action=method.split(<span class="string">'/'</span>)</span><br><span class="line">    path=<span class="string">"&#123;0&#125;\\ApiLog\\&#123;1&#125;\\"</span>.format(<span class="string">"C:\\Users\\Administrator\\Desktop\\"</span>,time.strftime(<span class="string">'%Y%m%d'</span>,time.localtime(time.time())))</span><br><span class="line">    fileName=action[len(action)<span class="number">-1</span>]+<span class="string">".log"</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line">      os.makedirs(path)</span><br><span class="line">    <span class="keyword">with</span> open (path+fileName, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        txt=<span class="string">"Url:\r\n&#123;0&#125;\r\n\r\nHeaders:\r\n&#123;1&#125;\r\n\r\nRequest payload:\r\n&#123;2&#125;\r\n\r\nTime:\r\n&#123;3&#125;\r\n\r\nResponse:\r\n&#123;4&#125;"</span>.format(method,headers,request,elapsed,response)</span><br><span class="line">        f.write(txt)</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 公共POST请求</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PostJson</span><span class="params">(method,request,header)</span>:</span></span><br><span class="line">    <span class="comment"># 请求头</span></span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">"Content-Type"</span>:<span class="string">"application/json; charset=UTF-8"</span>,</span><br><span class="line">        <span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36 ApiClient"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    Append(headers,header)</span><br><span class="line">    <span class="comment"># 响应参数</span></span><br><span class="line">    response=requests.post(method,data=json.dumps(request),headers=headers)</span><br><span class="line">    CreateLog(method,headers,request,response.elapsed,response.text)</span><br><span class="line">    <span class="comment"># 输出状态</span></span><br><span class="line">    print(<span class="string">"Status:&#123;0&#125;  Time:&#123;1&#125;"</span>.format(response.status_code,response.elapsed))</span><br><span class="line">    <span class="keyword">if</span>(response.status_code==<span class="number">200</span>):</span><br><span class="line">        print(response.text)</span><br><span class="line">    input(<span class="string">"Press &lt;enter&gt;"</span>)</span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> python </tag>
            
            <tag> Interface </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Financial Information Platform System</title>
      <link href="/article/cjx1inx0b000jp0rj7u1uuvof.html"/>
      <url>/article/cjx1inx0b000jp0rj7u1uuvof.html</url>
      
        <content type="html"><![CDATA[<h3 id="fip">FIP</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 功能按钮权限表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_ButtonPermission;</span><br><span class="line"><span class="comment">-- 系统功能表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_Module;</span><br><span class="line"><span class="comment">-- 功能按钮表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_ModuleButton;</span><br><span class="line"><span class="comment">-- 系统功能权限表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_ModulePermission;</span><br><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_User;</span><br><span class="line"><span class="comment">-- 用户关系表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_UserRelation;</span><br><span class="line"><span class="comment">-- 角色信息表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_Role;</span><br><span class="line"><span class="comment">-- 系统日志表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_Log;</span><br><span class="line"><span class="comment">-- 公司主体表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_Company;</span><br><span class="line"><span class="comment">-- 客商管理表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_Merchant;</span><br><span class="line"><span class="comment">-- 外包规则表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_OutsourcingRule;</span><br><span class="line"><span class="comment">-- 结算规则主表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_SettlementRule;</span><br><span class="line"><span class="comment">-- 结算规则明细表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_SettlementRuleDetailed;</span><br><span class="line"><span class="comment">-- 运费详细</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_FreightDetailed;</span><br><span class="line"><span class="comment">-- 人工费详细</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_LaborFeeDetailed;</span><br><span class="line"><span class="comment">-- 人工费其他</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_LaborFeeOther;</span><br><span class="line"><span class="comment">-- 退件费详细</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_ReturnFeeDetailed;</span><br><span class="line"><span class="comment">-- 仓租费详细</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_WarehouseFeeDetailed;</span><br><span class="line"><span class="comment">-- 结算规则日志表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_SettlementRuleLog;</span><br><span class="line"><span class="comment">-- 汇率表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_ExchangeRate;</span><br><span class="line"><span class="comment">-- 历史汇率表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_ExchangeRateHistory;</span><br><span class="line"><span class="comment">-- 月汇率任务表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_ExchangeRateToMonth;</span><br><span class="line"><span class="comment">-- 汇率告警</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_ExchangeRateAlarm;</span><br><span class="line"><span class="comment">-- 汇率告警日志</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_ExchangeRateLog;</span><br><span class="line"><span class="comment">-- 充值转账表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_Transfer;</span><br><span class="line"><span class="comment">-- 手工维护数据</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_ManualMaintain;</span><br><span class="line"><span class="comment">-- 定时服务</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_ScheduleInfo;</span><br><span class="line"><span class="comment">-- 应收台账视图</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_ReceivableAccountView;</span><br><span class="line"><span class="comment">-- 应收账龄视图</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_AgingReceivableView;</span><br><span class="line"><span class="comment">-- 客户账单表 账单管理</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_Bill;</span><br><span class="line"><span class="comment">-- 账单日志</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_BillLog;</span><br><span class="line"><span class="comment">-- 账单明细表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_BillDetailed;</span><br><span class="line"><span class="comment">-- 账单统计表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_BillStatistics;</span><br><span class="line"><span class="comment">-- 客户账单视图表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_BillView;</span><br><span class="line"><span class="comment">-- 业务账龄视图表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_BusinessAgingView;</span><br><span class="line"><span class="comment">-- 业务收入海外仓储视图表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_BusinessIncomeView;</span><br><span class="line"><span class="comment">-- 业务收入转运视图表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_BusinessIncomeViewByTMS;</span><br><span class="line"><span class="comment">-- 订单表(分区表)</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_Order;</span><br><span class="line"><span class="comment">-- 订单明细表（分区表）</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_OrderDetailed;</span><br><span class="line"><span class="comment">-- 订单SKU信息表（分区）</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_OrderSku;</span><br><span class="line"><span class="comment">-- 财务台账海外仓储视图表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_FinancialAccountView;</span><br><span class="line"><span class="comment">-- 财务台账海外仓储视图表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_FinancialAccountViewByTMS;</span><br><span class="line"><span class="comment">-- 订单费用海外仓储视图表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_OrderFeeView;</span><br><span class="line"><span class="comment">-- 订单费用转运视图表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_OrderToTMS;</span><br><span class="line"><span class="comment">-- 手工调账</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_ManualTransfer;</span><br><span class="line"><span class="comment">-- 客户映射表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_Merchant;</span><br><span class="line"><span class="comment">-- 仓库映射表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_Warehouse;</span><br><span class="line"><span class="comment">-- 编号规则表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_Coding;</span><br><span class="line"><span class="comment">-- 数据字典分类表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_DataItem;</span><br><span class="line"><span class="comment">-- 数据字典明细表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_DataItemDetail;</span><br><span class="line"><span class="comment">-- 页面显示配置</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_PageConfig;</span><br><span class="line"><span class="comment">-- 费用类型表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_TypesOfFee;</span><br><span class="line"><span class="comment">-- 费用类型关系、科目映射表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_TypesOfFeeRelation;</span><br><span class="line"><span class="comment">-- 仓库表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_Warehouse;</span><br><span class="line"><span class="comment">-- 仓库映射表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_WarehouseMap;</span><br><span class="line"><span class="comment">-- 客商与结算规则关联表（废弃）</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_MerchantRuleRelation;</span><br><span class="line"><span class="comment">-- F类账单业务包关联表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_BillPackage;</span><br><span class="line"><span class="comment">-- 账单业务包明细</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fin_BillBusinessPackage;</span><br><span class="line"><span class="comment">-- 金蝶推送日志表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_PushLog;</span><br><span class="line"><span class="comment">-- 金蝶科目映射日志</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_KingDeeCategoryLog;</span><br><span class="line"><span class="comment">-- 金蝶客户映射日志</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Base_KingDeeLog;</span><br><span class="line"><span class="comment">-- 金蝶应收单</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> KingDee_Receivables;</span><br><span class="line"><span class="comment">-- 金蝶物料表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> KingDee_ReceivablesDetailed;</span><br><span class="line"><span class="comment">-- 金蝶凭证</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> KingDee_Voucher;</span><br><span class="line"><span class="comment">-- 金蝶凭证科目</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> KingDee_VoucherDetailed;</span><br><span class="line"><span class="comment">-- 金蝶汇率</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> KingDee_Exchangerate;</span><br></pre></td></tr></table></figure><h4 id="清除账单数据">清除账单数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 客户账单表 账单管理</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_Bill;</span><br><span class="line"><span class="comment">-- 账单明细表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_BillDetailed;</span><br><span class="line"><span class="comment">-- 账单统计表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_BillStatistics;</span><br><span class="line"><span class="comment">-- 账单头程统计表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_BillStatisticsToFMS;</span><br><span class="line"><span class="comment">-- 客户账单视图表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_BillView;</span><br><span class="line"><span class="comment">-- 账单日志</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Base_BillLog;</span><br><span class="line"><span class="comment">-- 金蝶应收单</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> KingDee_Receivables;</span><br><span class="line"><span class="comment">-- 金蝶物料表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> KingDee_ReceivablesDetailed;</span><br><span class="line"><span class="comment">-- 金蝶凭证</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> KingDee_Voucher;</span><br><span class="line"><span class="comment">-- 金蝶凭证科目</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> KingDee_VoucherDetailed;</span><br><span class="line"><span class="comment">-- 推送日志表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Base_PushLog;</span><br><span class="line"><span class="comment">-- 业务包关联表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_BillPackage;</span><br><span class="line"><span class="comment">-- 业务包表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_BillBusinessPackage;</span><br><span class="line"><span class="comment">-- 财务台账海外仓储视图表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_FinancialAccountView;</span><br><span class="line"><span class="comment">-- 财务台账转运视图表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_FinancialAccountViewByTMS;</span><br><span class="line"><span class="comment">-- 应收账龄视图</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_AgingReceivableView;</span><br></pre></td></tr></table></figure><h4 id="清除f类账单">清除F类账单</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Fin_BillPackage <span class="keyword">WHERE</span> BusinessPackageCode <span class="keyword">IN</span> (<span class="keyword">SELECT</span> BusinessPackageCode <span class="keyword">FROM</span> Fin_Bill <span class="keyword">WHERE</span> SettlementRuleId&gt;<span class="number">0</span>);</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Fin_BillView <span class="keyword">WHERE</span> BillNumber <span class="keyword">IN</span> (<span class="keyword">SELECT</span> BillNumber <span class="keyword">FROM</span> Fin_Bill <span class="keyword">WHERE</span> SettlementRuleId&gt;<span class="number">0</span>);</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Fin_BillDetailed <span class="keyword">WHERE</span> BillId <span class="keyword">IN</span> (<span class="keyword">SELECT</span> BillId <span class="keyword">FROM</span> Fin_Bill <span class="keyword">WHERE</span> SettlementRuleId&gt;<span class="number">0</span>);</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Fin_BillStatistics <span class="keyword">WHERE</span> BillId <span class="keyword">IN</span> (<span class="keyword">SELECT</span> BillId <span class="keyword">FROM</span> Fin_Bill <span class="keyword">WHERE</span> SettlementRuleId&gt;<span class="number">0</span>);</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Fin_Bill <span class="keyword">WHERE</span> SettlementRuleId&gt;<span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="清除订单数据">清除订单数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 订单表(分区表)</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_Order;</span><br><span class="line"><span class="comment">-- 订单明细表（分区表）</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_OrderDetailed;</span><br><span class="line"><span class="comment">-- 订单SKU信息表（分区）</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_OrderSku;</span><br><span class="line"><span class="comment">-- 订单费用海外仓储视图表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_OrderFeeView;</span><br><span class="line"><span class="comment">-- 订单费用转运视图表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_OrderToTMS;</span><br><span class="line"><span class="comment">-- 应收台账视图</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_ReceivableAccountView;</span><br><span class="line"><span class="comment">-- 业务账龄视图表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_BusinessAgingView;</span><br><span class="line"><span class="comment">-- 业务收入海外仓储视图表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_BusinessIncomeView;</span><br><span class="line"><span class="comment">-- 业务收入转运视图表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> Fin_BusinessIncomeViewByTMS;</span><br></pre></td></tr></table></figure><h3 id="bsc">BSC</h3><h3 id="wms">WMS</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 客户账单</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> bil_customer_bill <span class="keyword">where</span> bcb_status =<span class="number">4</span> <span class="keyword">and</span> customer_code=<span class="string">'@customer_code'</span> <span class="keyword">AND</span> <span class="keyword">DATE_FORMAT</span>(bcb_add_time, <span class="string">'%Y-%m'</span> ) = <span class="keyword">DATE_FORMAT</span>(<span class="string">'@bcb_add_time'</span>, <span class="string">'%Y-%m'</span>);</span><br><span class="line"><span class="comment">-- 客户期初期末余额</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> bil_customer_bill_surplus <span class="keyword">where</span> bcb_id=<span class="string">'@bcb_id'</span>; </span><br><span class="line"><span class="comment">-- 客户本期收入</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> bil_business <span class="keyword">as</span> t  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> bil_income <span class="keyword">as</span> t1 <span class="keyword">ON</span>(t.bb_id=t1.bb_id) <span class="keyword">where</span> t1.bcb_id=<span class="string">'@bcb_id'</span> <span class="keyword">and</span> t.ds_code=<span class="string">'cp'</span> <span class="keyword">and</span> t1.ft_code=<span class="string">'pay'</span>;</span><br><span class="line"><span class="comment">-- 客户本期支出</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> bil_business <span class="keyword">as</span> t  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> bil_income <span class="keyword">as</span> t1 <span class="keyword">ON</span>(t.bb_id=t1.bb_id) <span class="keyword">where</span> t1.bcb_id=<span class="string">'@bcb_id'</span> <span class="keyword">and</span> t.ds_code!=<span class="string">'cp'</span> <span class="keyword">and</span> t1.ft_code!=<span class="string">'pay'</span>;</span><br><span class="line"><span class="comment">-- 本期充值记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IFNULL</span>(<span class="keyword">sum</span>(apr_amount),<span class="number">0</span>) <span class="keyword">from</span> account_payment_records <span class="keyword">where</span> apr_refer_code=(<span class="keyword">SELECT</span> bb_refer_code <span class="keyword">from</span> bil_business_attach  <span class="keyword">where</span> bb_id=<span class="string">'@bb_id'</span>);</span><br><span class="line"><span class="comment">-- 本期支出记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IFNULL</span>(<span class="keyword">sum</span>(apr_amount),<span class="number">0</span>) <span class="keyword">from</span> account_payment_records <span class="keyword">where</span> apr_refer_code=(<span class="keyword">SELECT</span> bb_refer_code <span class="keyword">from</span> bil_business_attach  <span class="keyword">where</span> bb_id=<span class="string">'@bb_id'</span>);</span><br><span class="line"><span class="comment">-- 账单统计</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> bil_income  <span class="keyword">as</span> t <span class="keyword">INNER</span> <span class="keyword">JOIN</span>  bil_business  <span class="keyword">as</span> t1 <span class="keyword">on</span> (t1.bb_id=t.bb_id) <span class="keyword">where</span> bcb_id=<span class="string">'@bcb_id'</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取订单信息</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> bil_business_attach <span class="keyword">AS</span> t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders <span class="keyword">AS</span> t <span class="keyword">ON</span> ( t1.bb_refer_code = t.order_code ) </span><br><span class="line">                                        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> bil_business <span class="keyword">AS</span> t2 <span class="keyword">ON</span> ( t1.bb_id = t2.bb_id )</span><br><span class="line">                                        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> warehouse <span class="keyword">AS</span> t4 <span class="keyword">ON</span> ( t4.warehouse_id = t2.warehouse_id )</span><br><span class="line">                                        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> order_address_book <span class="keyword">AS</span> t5 <span class="keyword">ON</span> ( t5.order_id = t.order_id )</span><br><span class="line">                                        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> ship_order <span class="keyword">AS</span> t7 <span class="keyword">ON</span> ( t7.order_id = t.order_id )</span><br><span class="line">                                        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> after_sales_return_orders <span class="keyword">AS</span> t9 <span class="keyword">ON</span> ( t1.bb_refer_code = t9.asro_code )</span><br><span class="line"><span class="keyword">WHERE</span> t.customer_code = <span class="string">'@customer_code'</span> <span class="keyword">AND</span> <span class="keyword">DATE_FORMAT</span>(t.add_time, <span class="string">'%Y-%m-%d'</span> ) = <span class="string">'@add_time'</span>;</span><br></pre></td></tr></table></figure><h3 id="tcms">TCMS</h3><h4 id="账单服务">账单服务</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取账单</span></span><br><span class="line"><span class="keyword">SELECT</span> sb_id,sb_labelcode, customer_id, currency_code, charge_address_id, sb_billdate, sb_publishfile, sb_createdate, bill_status,last_balance,balance,sb_amount  <span class="keyword">FROM</span> bil_shipperbill  <span class="keyword">WHERE</span> bill_status = <span class="number">4</span>;</span><br><span class="line"><span class="comment">-- 获取上期账单结束时间</span></span><br><span class="line"><span class="keyword">SELECT</span> sb_billdate <span class="keyword">FROM</span> bil_shipperbill <span class="keyword">WHERE</span> bill_status = <span class="number">4</span> <span class="keyword">AND</span> customer_id = @customer_id <span class="keyword">AND</span> <span class="keyword">DATE_FORMAT</span>( sb_billdate, <span class="string">'%Y-%m-%d'</span> ) &lt; @sb_billdate <span class="keyword">ORDER</span> <span class="keyword">BY</span> sb_billdate <span class="keyword">desc</span> <span class="keyword">LIMIT</span> <span class="number">1</span>; </span><br><span class="line"><span class="comment">-- 获取客户信息</span></span><br><span class="line"><span class="keyword">SELECT</span> customer_code,customer_allname,billcompany_id <span class="keyword">from</span>  csi_customer <span class="keyword">where</span> customer_id=@customer_id;</span><br><span class="line"><span class="comment">-- 获取本期充值数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IFNULL</span>( <span class="keyword">SUM</span>( actual_money_sum ), <span class="number">0</span> ) total_money <span class="keyword">FROM</span>(<span class="keyword">SELECT</span> <span class="keyword">IFNULL</span>( collection_date, sc_createdate ) collection_date,<span class="keyword">IFNULL</span>( actual_money_sum, sc_currentamount ) actual_money_sum <span class="keyword">FROM</span> stm_shippercurrent <span class="keyword">WHERE</span> sm_code = <span class="string">'EE'</span> <span class="keyword">AND</span> fm_code = <span class="string">'CA'</span> <span class="keyword">AND</span> scs_code = <span class="string">'C'</span> <span class="keyword">AND</span> customer_id = @customer_id <span class="keyword">AND</span> ck_code = @ck_code <span class="keyword">AND</span> sc_createdate &gt; @sc_createdate <span class="keyword">AND</span> sc_createdate &lt;= @sc_createdate <span class="keyword">AND</span> collection_date &gt;<span class="string">'2019-08-31 16:00:00'</span> )t</span><br><span class="line"><span class="comment">-- 查询当期账单对应地图表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> bil_shipperbill_mapping <span class="keyword">where</span> sb_id=@sb_id</span><br><span class="line"><span class="comment">-- 循环账单地图表，获取参与结算账单的 明细表数据</span></span><br><span class="line"><span class="keyword">SELECT</span> ic_amount,fk_code,unit_code,og_id,currency_code,serve_hawbcode,refer_hawbcode,shipper_hawbcode,amount_type,bs_id <span class="keyword">from</span> @table_name <span class="keyword">where</span> sb_id=@sb_id</span><br><span class="line"><span class="comment">-- 查询仓库</span></span><br><span class="line"><span class="keyword">SELECT</span> og_shortcode,og_name <span class="keyword">from</span> sys_organization <span class="keyword">where</span> og_id=og_id;</span><br><span class="line"><span class="comment">-- 查询净重</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IFNULL</span>(checkin_grossweight,<span class="number">0</span>) checkin_grossweight <span class="keyword">FROM</span> bsn_business <span class="keyword">where</span> bs_id=@bs_id;</span><br></pre></td></tr></table></figure><div id="flowchart-0" class="flow-chart"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: SynchronizeTmsBillcond1=>condition: 创建T类账单op1=>operation: 1.创建账单业务包明细 2.创建金蝶应收单数据 3.创建财务台账e=>end: 结束st->cond1->econd1(yes)->op1</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script>]]></content>
      
      
      
        <tags>
            
            <tag> 梳理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CESyncService</title>
      <link href="/article/cjw6a58uh01k4uz7zrhsw13z2.html"/>
      <url>/article/cjw6a58uh01k4uz7zrhsw13z2.html</url>
      
        <content type="html"><![CDATA[<div id="flowchart-0" class="flow-chart"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: 新一代物流推送服务(CESyncService)op1=>operation: 获取PackageStatusFlow待推送数据(3已收寄、5发往X机场、6到达X机场、8离开X机场、11开始清关)op2=>operation: PackageStatusFlow.ID>SysLog.IDop3=>operation: 升序取前50条物流号op4=>operation: 组装请求msgBody数据op5=>operation: msgBody数据MD5加密cond1=>condition: 新一代推送平台接口op6=>operation: 本地.TXT日志：物流数据上传成功op7=>operation: 本地.TXT日志：更新扫描ID:IDop8=>operation: SysLog表写入当前自动增长流水ID值op9=>operation: 本地.TXT日志：时间更新成功callbackError=>operation: 本地.TXT日志：物流数据上传失败e=>end: 结束st->op1->op2->op3->op4->op5->cond1->op6->op7->op8->op9->econd1(yes)->op6cond1(no)->callbackError</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script>]]></content>
      
      
      
        <tags>
            
            <tag> 流程图 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>商业渠道</title>
      <link href="/article/cjw6a5yigmgjdr1uz78kjnzfs.html"/>
      <url>/article/cjw6a5yigmgjdr1uz78kjnzfs.html</url>
      
        <content type="html"><![CDATA[<h3 id="网页录单">网页录单</h3><div id="flowchart-0" class="flow-chart"></div><h3 id="api-excel导入">API、Excel导入</h3><div id="flowchart-1" class="flow-chart"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: 网页录单cond1=>condition: 是否预报成功op1=>operation: 打印面单(LabelPrintService/PrintLabel)cond2=>condition: Basic Auth授权op2=>operation: MD5加密数据Token(LabelPrintToken)cond3=>condition: 是否存在op3=>operation: 获取渠道插件cond4=>condition: 超过3次错误cond5=>condition: 请求中并在20分钟内cond5=>condition: 一票一证是否24小时内op4=>operation: 渠道分发op5=>operation: 渠道打印面单实现op6=>operation: 拼装请求数据，调用第三方接口op7=>operation: 生成面单op8=>operation: 压缩图片保存服务器op9=>operation: 生成标识返回createOrderError=>operation: 问题件/换号中callbackError=>operation: 返回错误信息callbackMsg=>operation: 返回原数据st->cond1->op1->cond2->op2->cond3->op3->op4->op5->op6->op7->op8->op9cond1(yes)->op1cond1(no)->createOrderErrorcond2(yes)->op2cond2(no)->callbackErrorcond3(yes)->cond4cond3(no)->op3cond4(yes,right)->callbackErrorcond4(no)->cond5(no)->op3cond5(yes)->callbackMsg</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><textarea id="flowchart-1-code" style="display: none">st=>start: API、Excel导入op1=>operation: 请求接口(Order/PacketOrder)op2=>operation: 提交Toms(TomsOrder)op3=>operation: windows服务(ZT.Toms.QuartzLabelGet)op4=>operation: 获取云途订单和15分钟前非云途订单op5=>operation: 开始制单op6=>operation: 转换数据op7=>operation: 获取渠道插件op8=>operation: 渠道打印面单实现op9=>operation: 拼装请求数据，调用第三方接口op10=>operation: 生成面单op11=>operation: 压缩图片保存服务器op12=>operation: 生成标识返回st->op1->op2->op3->op4->op5(right)->op6->op7->op8->op9->op10->op11->op12</textarea><textarea id="flowchart-1-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-1", options);</script>]]></content>
      
      
      
        <tags>
            
            <tag> 流程图 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中邮海外购</title>
      <link href="/article/cjw6a5ygs0001k4uz781613z1.html"/>
      <url>/article/cjw6a5ygs0001k4uz781613z1.html</url>
      
        <content type="html"><![CDATA[<h3 id="中邮b">中邮B</h3><h4 id="直邮">直邮</h4><blockquote><p>直接到达货运仓它只有<strong>原单</strong>。</p></blockquote><div id="flowchart-0" class="flow-chart"></div><h4 id="转运">转运</h4><blockquote><p>它只有<strong>原单、合单、拆箱单</strong>。<br>合单：一个客户订单号对应多个跟踪单号;<br>拆箱单：一个跟踪订单号对应多个客户订单号;<br><strong>包裹签收产生物流单号</strong></p></blockquote><div id="flowchart-1" class="flow-chart"></div><h3 id="中邮c">中邮C</h3><div id="flowchart-2" class="flow-chart"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: 直邮inpu2=>inputoutput: 创建订单inpu1=>inputoutput: 上传身份证cond2=>condition: 证件审核cond3=>condition: 包裹签收op4=>operation: 包裹上架op5=>operation: 包裹下架op6=>operation: 生成批次号op7=>operation: 分拣装板op8=>operation: 出库扫描callbackError=>operation: 余额不足callIDCardError=>operation: 身份证信息不规范callPageError=>operation: 包裹未就绪e=>end: 结束st->inpu2(right)->inpu1->cond2->cond3->op4(right)->op5->op6->op7->op8->econd2(yes)->cond3(yes)->op4cond2(no,right)->callIDCardErrorcond3(no,right)->callPageError</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><textarea id="flowchart-1-code" style="display: none">st=>start: 转运opt1=>operation: 下载模板inpu1=>inputoutput: 上传运单cond1=>condition: 订单审核cond3=>condition: 包裹签收op4=>operation: 包裹上架op5=>operation: 包裹下架op6=>operation: 生成批次号op7=>operation: 分拣装板op8=>operation: 出库扫描callbackError=>operation: 备注原因callPageError=>operation: 包裹未就绪e=>end: 结束st->opt1->inpu1->cond1->op4(right)->op5->op6->op7->op8->econd1(yes)->cond3(yes)->op4cond1(no,right)->callbackErrorcond3(no,right)->callPageError</textarea><textarea id="flowchart-1-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-1", options);</script><textarea id="flowchart-2-code" style="display: none">st=>start: 预报包裹cond1=>condition: 包裹审核op2=>operation: (镖客)包裹签收cond2=>condition: 服务是否开启op3=>operation: (镖客)通知管理op4=>operation: 支付运费op5=>operation: (镖客)包裹上架op6=>operation: (镖客)包裹下架op7=>operation: (镖客)生成批次号op8=>operation: (镖客)分拣装板op9=>operation: (镖客)出库扫描cond3=>condition: 服务是否开启op10=>operation: (镖客)通知管理callbackError=>operation: 备注不通过原因callPageError=>operation: 包裹未就绪op11=>operation: 结束st->cond1->op2->cond2->op3->op4->op5(right)->op6->op7->op8->op9->cond3->op10->op11cond1(no)->callbackErrorcond1(yes)->op2cond2(no)->op3cond2(yes)->op4cond3(no)->op10cond3(yes)->op11</textarea><textarea id="flowchart-2-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-2-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-2-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-2", options);</script>]]></content>
      
      
      
        <tags>
            
            <tag> 流程图 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP服务</title>
      <link href="/article/cjvrpjvxl0003n4uze8jvm7wh.html"/>
      <url>/article/cjvrpjvxl0003n4uze8jvm7wh.html</url>
      
        <content type="html"><![CDATA[<h1 id="wcf-webapi-webservice">WCF、WebAPI、WebService</h1><h2 id="web-service">Web Service</h2><ol><li>它是基于SOAP协议的，数据格式是XML</li><li>只支持HTTP协议</li><li>它不是开源的，但可以被任意一个了解XML的人使用</li><li>它只能部署在IIS上</li></ol><h2 id="wcf">WCF</h2><ol><li>这个也是基于SOAP的，数据格式是XML</li><li>这个是Web Service（ASMX）的进化版，可以支持各种各样的协议，像TCP，HTTP，HTTPS，Named Pipes, MSMQ.</li><li>WCF的主要问题是，它配置起来特别的繁琐</li><li>它不是开源的，但可以被任意一个了解XML的人使用</li><li>它可以部署应用程序中或者IIS上或者Windows服务中</li></ol><h2 id="web-api">Web API</h2><ol><li>这是一个简单的构建HTTP服务的新框架</li><li>在.net平台上Web API 是一个开源的、理想的、构建REST-ful 服务的技术</li><li>不像WCF REST Service.它可以使用HTTP的全部特点（比如URIs、request/response头，缓存，版本控制，多种内容格式）</li><li>它也支持MVC的特征，像路由、控制器、action、filter、模型绑定、控制反转（IOC）或依赖注入（DI），单元测试。这些可以使程序更简单、更健壮</li><li>它可以部署在应用程序和IIS上</li><li>这是一个轻量级的框架，并且对限制带宽的设备，比如智能手机等支持的很好</li><li>Response可以被Web API的MediaTypeFormatter转换成Json、XML 或者任何你想转换的格式。</li></ol><p>技术这么多，我该选谁？</p><ol><li>当你想创建一个支持消息、消息队列、双工通信的服务时，你应该选择WCF</li><li>当你想创建一个服务，可以用更快速的传输通道时，像TCP、NamedPipes或者甚至是UDP（在WCF4.5中）,在其他传输通道不可用的时候也可以支持HTTP。</li><li>当你想创建一个基于HTTP的面向资源的服务并且可以使用HTTP的全部特征时（比如URIs、request/response头，缓存，版本控制，多种内容格式），你应该选择WebAPI</li><li>当你想让你的服务用于浏览器、手机、iPhone和平板电脑时，你应该选择Web API</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 接口 </tag>
            
            <tag> 服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于jquery、bootstrap弹窗组件</title>
      <link href="/article/cjvrpjvxu0006n4uzr7sd6w0i.html"/>
      <url>/article/cjvrpjvxu0006n4uzr7sd6w0i.html</url>
      
        <content type="html"><![CDATA[<h2 id="简介">简介</h2><blockquote><p><code>模块化</code>、<code>低耦合</code>、<code>高扩展性</code> 的架构设计为降低开发难度，提升开发效率而生。</p></blockquote><h2 id="准备">准备</h2><blockquote><p>为减小带宽占用、降低可读性防止投机取巧者更改程序 ,js文件必须<code>压缩</code>之后方可引用。<br>现有组件已默认添加对应js，开发直接引用对应<code>view.cshtml</code>即可</p></blockquote><h3 id="核心20">核心2.0</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"https://code.jquery.com/jquery-1.11.3.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">@System.Web.Optimization.Scripts.Render(<span class="string">"~/bundles/Modules/core.js"</span>)</span><br></pre></td></tr></table></figure><h3 id="商品组件20">商品组件2.0</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Html.Partial(<span class="string">"~/Modules/shangpin/view.cshtml"</span>)</span><br><span class="line">&lt;link href=<span class="string">"~/Content/css/tree.css"</span> rel=<span class="string">"stylesheet"</span> /&gt;</span><br><span class="line">@System.Web.Optimization.Scripts.Render(<span class="string">"~/bundles/Modules/shangpin.js"</span>)</span><br></pre></td></tr></table></figure><h3 id="代金券组件20">代金券组件2.0</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Html.Partial(<span class="string">"~/Modules/daijinquan/view.cshtml"</span>)</span><br><span class="line">@System.Web.Optimization.Scripts.Render(<span class="string">"~/bundles/Modules/daijinquan.js"</span>)</span><br></pre></td></tr></table></figure><h3 id="门店组件20">门店组件2.0</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Html.Partial(<span class="string">"~/Modules/mendian/view.cshtml"</span>)</span><br><span class="line">@System.Web.Optimization.Scripts.Render(<span class="string">"~/bundles/Modules/mendian.js"</span>)</span><br></pre></td></tr></table></figure><h3 id="会员组件20">会员组件2.0</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Html.Partial(<span class="string">"~/Modules/huiyuan/view.cshtml"</span>)</span><br><span class="line">@System.Web.Optimization.Scripts.Render(<span class="string">"~/bundles/Modules/huiyuan.js"</span>)</span><br></pre></td></tr></table></figure><h3 id="拼团组件20">拼团组件2.0</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Html.Partial(<span class="string">"~/Modules/pintuan/view.cshtml"</span>)</span><br><span class="line">@System.Web.Optimization.Scripts.Render(<span class="string">"~/bundles/Modules/pintuan.js"</span>)</span><br></pre></td></tr></table></figure><h3 id="团购组件20">团购组件2.0</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Html.Partial(<span class="string">"~/Modules/tuangou/view.cshtml"</span>)</span><br><span class="line">@System.Web.Optimization.Scripts.Render(<span class="string">"~/bundles/Modules/tuangou.js"</span>)</span><br></pre></td></tr></table></figure><h2 id="api">API</h2><h3 id="内置参数">内置参数</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dialog:#窗口;  </span><br><span class="line">title:#窗口标题;  </span><br><span class="line">toolbar:#窗口工具栏;  </span><br><span class="line">startDate:#开始时间;  </span><br><span class="line">endDate:#结束时间;  </span><br><span class="line">search:#搜索按钮;  </span><br><span class="line">keyword: #关键字;  </span><br><span class="line">batch:#批量添加按钮;  </span><br><span class="line">table:#bootstrapTable;  </span><br><span class="line">grid:当前表格数据;</span><br><span class="line">category:当前分类数据;</span><br><span class="line">skuEnabled:是否启用SKU，默认false 或 null;  </span><br><span class="line">sortSingleEnabled:是否启用分类悬浮选择，默认false 或 null;</span><br><span class="line">isPost:是否可提交，默认true;</span><br><span class="line">limit:总条数;</span><br><span class="line">modules.debug:是否开启调试，默认true;</span><br></pre></td></tr></table></figure><h3 id="内置方法">内置方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">.debugLog = <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//调试日志</span></span><br><span class="line">&#125;</span><br><span class="line">.formatSet = <span class="function"><span class="keyword">function</span> (<span class="params">value, row, index</span>) </span>&#123;</span><br><span class="line">   <span class="comment">//格式化操作按钮</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">"&lt;a href='javascript:;' data-index='"</span> + index + <span class="string">"' class='btn btn-primary btn-xs'&gt;选择&lt;/a&gt;"</span>;</span><br><span class="line">&#125;;</span><br><span class="line">.formatSortSet = <span class="function"><span class="keyword">function</span> (<span class="params">value, row, index</span>) </span>&#123;</span><br><span class="line">   <span class="comment">//格式化分类操作按钮</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">"&lt;button class='addBtn btn btn-primary btn-xs'&gt;添加&lt;/button&gt;"</span>;</span><br><span class="line">&#125;;</span><br><span class="line">.formatCheckbox = <span class="function"><span class="keyword">function</span> (<span class="params">value, row, index, self</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//SkuCount&gt;0，则表示SKU商品</span></span><br><span class="line">    <span class="comment">//ItemType=2，则表示套餐商品</span></span><br><span class="line">    <span class="comment">//详细请参考枚举YhHelper.EnumItemType</span></span><br><span class="line">     <span class="keyword">if</span> (row.SkuCount &gt; <span class="number">0</span> || row.ItemType == <span class="number">2</span>) &#123;</span><br><span class="line">        self.checkbox = <span class="literal">false</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        self.checkbox = <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br><span class="line">.afterSelect = <span class="function"><span class="keyword">function</span> (<span class="params">data, element</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//批量、单选以arry集合返回 </span></span><br><span class="line">    <span class="comment">//data=&#123;grid:表格数据,category:分类数据&#125;    </span></span><br><span class="line">    <span class="comment">//element返回当前单选元素</span></span><br><span class="line">    <span class="keyword">this</span>.debugLog(data);</span><br><span class="line">&#125;;</span><br><span class="line">.singleButton = <span class="function"><span class="keyword">function</span> (<span class="params">element</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//重写单选按钮事件</span></span><br><span class="line">&#125;</span><br><span class="line">.sortSingleButton= <span class="function"><span class="keyword">function</span> (<span class="params">element</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//重写分类悬浮单选按钮事件</span></span><br><span class="line">&#125;</span><br><span class="line">.batchButton = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//重写批量添加按钮事件</span></span><br><span class="line">&#125;</span><br><span class="line">.initGrid(&#123;</span><br><span class="line">    <span class="comment">//某元素触发后需调用函数</span></span><br><span class="line">    <span class="comment">//底层采用bootstrapTable，SO!键值传参是一样的</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="标题头示例">标题头示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//S:手动添加标签到商品组件</span></span><br><span class="line">$(.title).remove();</span><br><span class="line">$(<span class="string">'&lt;div class="row"&gt;'</span></span><br><span class="line">       +<span class="string">'&lt;div class="pull-left" style="padding-top: 5px; margin-right: 10px; margin-left: 10px"&gt;'</span></span><br><span class="line">             +<span class="string">'&lt;h4 class="modal-title" id="shangpinTitle"&gt;选择商品&lt;font style="color:red;font-size:13px"&gt;重点提示内容&lt;/font&gt;&lt;/h4&gt;'</span></span><br><span class="line">       +<span class="string">'&lt;/div&gt;'</span></span><br><span class="line"> +<span class="string">'&lt;/div&gt;'</span>).insertAfter(.dialog + <span class="string">" button.close"</span>);</span><br><span class="line"><span class="comment">//E:手动添加标签到商品组件</span></span><br></pre></td></tr></table></figure><h3 id="商品示例">商品示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> msp = <span class="keyword">new</span> modules.shangpin();</span><br><span class="line">msp.initGrid(&#123;</span><br><span class="line">    url: <span class="string">"/Item/GetStoreItemByCategoryIdEx"</span>,</span><br><span class="line">    queryParams: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            operstoreid: 门店ID,</span><br><span class="line">            keyword: $(msp.keyword).val(),</span><br><span class="line">            limit: <span class="keyword">this</span>.pageSize,</span><br><span class="line">            offset: <span class="keyword">this</span>.pageNumber</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//初始化商品分类，则启用</span></span><br><span class="line">msp.initCategory(&#123;</span><br><span class="line">    url: <span class="string">"/ItemCategory/GetCategoryInfo?StoreID=门店ID"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//初始化SKU商品选择，skuEnabled=true则启用</span></span><br><span class="line">msp.initSku(&#123;</span><br><span class="line">    enabled: <span class="literal">true</span>,</span><br><span class="line">    url: <span class="string">"/Item/GetSkuLevel?operstoreid=门店ID"</span>,</span><br><span class="line">    getUrl: <span class="string">"/Item/GetSelectedItemSkuDetail?operstoreid=门店ID"</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="代金券示例">代金券示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> djq = <span class="keyword">new</span> modules.daijinquan();</span><br><span class="line"><span class="comment">//某元素触发后需调用函数</span></span><br><span class="line">djq.initGrid(&#123;</span><br><span class="line">  url: <span class="string">"/CommonAPI/GetCouponList"</span>,</span><br><span class="line">  queryParams: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> &#123;</span><br><span class="line">           CompanyID:公司ID,</span><br><span class="line">           Keyword: $(djq.keyword).val(),</span><br><span class="line">           StartDate: $(djq.startDate).val(),</span><br><span class="line">           EndDate: $(djq.endDate).val(),</span><br><span class="line">           limit: <span class="keyword">this</span>.pageSize,</span><br><span class="line">           offset: <span class="keyword">this</span>.pageNumber</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="门店示例">门店示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mmd = <span class="keyword">new</span> modules.mendian();</span><br><span class="line">mmd.initGrid(&#123;</span><br><span class="line">   url: <span class="string">"/CommonAPI/GetShopsList"</span>,</span><br><span class="line">   queryParams: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> &#123;</span><br><span class="line">           StoreID: 门店ID,</span><br><span class="line">           Keyword: $(mmd.keyword).val(),</span><br><span class="line">           limit: <span class="keyword">this</span>.pageSize,</span><br><span class="line">           offset: <span class="keyword">this</span>.pageNumber</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="会员示例">会员示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hyc = <span class="keyword">new</span> modules.huiyuan();</span><br><span class="line">hyc.initGrid(&#123;</span><br><span class="line">   url: <span class="string">"/CommonAPI/GetcardLisrt"</span>,</span><br><span class="line">   queryParams: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> &#123;</span><br><span class="line">           storeid:门店ID,</span><br><span class="line">           Keyword: $(hyc.keyword).val(),</span><br><span class="line">           limit: <span class="keyword">this</span>.pageSize,</span><br><span class="line">           offset: <span class="keyword">this</span>.pageNumber</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="拼团示例">拼团示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mpt = <span class="keyword">new</span> modules.pintuan();</span><br><span class="line">mpt.initGrid(&#123;</span><br><span class="line">        url: <span class="string">'/pagelayout/GetPinItemList'</span>,</span><br><span class="line">        queryParams: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                storeId: 门店ID,</span><br><span class="line">                keywords:$(mpt.keyword).val(),</span><br><span class="line">                pageSize: <span class="keyword">this</span>.pageSize,</span><br><span class="line">                pageIndex: <span class="keyword">this</span>.pageNumber</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure><h3 id="团购示例">团购示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mtg = <span class="keyword">new</span> modules.tuangou();</span><br><span class="line">mtg.initGrid(&#123;</span><br><span class="line">        url: <span class="string">'/pagelayout/GetTuanItemList'</span>,</span><br><span class="line">        queryParams: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                companyId: 公司ID,</span><br><span class="line">                keywords: $(mtg.keyword).val(),</span><br><span class="line">                pageSize: <span class="keyword">this</span>.pageSize,</span><br><span class="line">                pageIndex: <span class="keyword">this</span>.pageNumber</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
